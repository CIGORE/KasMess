<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KasMess - Aplikasi Pengelolaan Kas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        primaryDark: '#4a49c0',
                        secondary: '#6C757D',
                        success: '#198754',
                        danger: '#DC3545',
                        warning: '#FFC107',
                        info: '#0DCAF0',
                        light: '#F8F9FA',
                        dark: '#212529',
                        darkBg: '#181818',
                        darkCard: '#242424'
                    }
                }
            }
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-in-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .progress-bar {
            transition: width 1s ease-in-out;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #2d2d2d;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Number inputs remove arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        
        /* Toggle Switch */
        input:checked ~ .dot {
            transform: translateX(100%);
            background-color: #fff;
        }
        
        input:checked ~ .block {
            background-color: #5D5CDE;
        }
        
        /* Filter tabs */
        .filter-tab.active {
            background-color: #5D5CDE;
            color: white;
        }
        
        .dark .filter-tab.active {
            background-color: #5D5CDE;
            color: white;
        }
        
        .filter-tab:not(.active) {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        .dark .filter-tab:not(.active) {
            background-color: #374151;
            color: #d1d5db;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-darkBg min-h-screen">
    <div id="app" class="max-w-5xl mx-auto p-4">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">KasMess</h1>
            </div>
            <div class="flex items-center">
                <!-- Role Switch untuk demo -->
                <div class="mr-4 bg-gray-200 dark:bg-gray-700 rounded-lg p-1 hidden md:flex">
                    <button id="admin-view" class="py-1 px-3 rounded-md text-sm font-medium bg-primary text-white">Admin</button>
                    <button id="resident-view" class="py-1 px-3 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300">Penghuni</button>
                </div>
                
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="ri-sun-line text-gray-800 dark:text-white text-xl dark:hidden"></i>
                    <i class="ri-moon-line text-gray-800 dark:text-white text-xl hidden dark:block"></i>
                </button>
                <div class="relative ml-4">
                    <button id="user-menu-button" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-primary">
                        <div class="h-8 w-8 rounded-full bg-primary flex items-center justify-center text-white">
                            <span id="user-initial">A</span>
                        </div>
                    </button>
                    <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-darkCard rounded-md shadow-lg z-10 fade-in">
                        <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                            <p class="text-sm font-medium text-gray-900 dark:text-white" id="user-name">Admin</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="user-email">admin@kasmess.com</p>
                            <p class="text-xs mt-1 text-gray-500 dark:text-gray-400">
                                Role: <span id="user-role-display" class="font-medium text-primary">Administrator</span>
                            </p>
                        </div>
                        <div class="py-1">
                            <button id="edit-profile" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i class="ri-user-settings-line mr-2"></i> Edit Profil
                            </button>
                            <button id="change-user" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i class="ri-user-shared-line mr-2"></i> Ganti Pengguna
                            </button>
                            <div class="md:hidden border-t border-gray-200 dark:border-gray-700 mt-1 pt-1">
                                <button id="mobile-admin-view" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="ri-shield-user-line mr-2"></i> Mode Admin
                                </button>
                                <button id="mobile-resident-view" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="ri-user-line mr-2"></i> Mode Penghuni
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Role Indicator Banner -->
        <div id="role-indicator" class="bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 px-4 py-2 rounded-lg mb-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="ri-shield-user-line mr-2 text-lg"></i>
                <span>Anda sedang melihat sebagai <strong id="role-name">Administrator</strong></span>
            </div>
            <button id="switch-role-btn" class="text-xs bg-blue-200 dark:bg-blue-800 px-2 py-1 rounded hover:bg-blue-300 dark:hover:bg-blue-700 transition-colors">
                Ganti ke Mode Penghuni
            </button>
        </div>

        <!-- Main Navigation -->
        <nav class="bg-white dark:bg-darkCard rounded-lg shadow-sm mb-6">
            <div class="overflow-x-auto">
                <div class="flex">
                    <button class="tab-link active flex-1 whitespace-nowrap py-3 px-4 text-center border-b-2 border-primary font-medium text-primary" data-tab="dashboard">
                        <i class="ri-dashboard-line mr-1"></i> Dashboard
                    </button>
                    <button class="tab-link flex-1 whitespace-nowrap py-3 px-4 text-center border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300" data-tab="transaksi">
                        <i class="ri-exchange-funds-line mr-1"></i> Transaksi
                    </button>
                    <button class="tab-link flex-1 whitespace-nowrap py-3 px-4 text-center border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 admin-only" data-tab="penghuni">
                        <i class="ri-user-line mr-1"></i> Penghuni
                    </button>
                    <button class="tab-link flex-1 whitespace-nowrap py-3 px-4 text-center border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300" data-tab="laporan">
                        <i class="ri-bar-chart-line mr-1"></i> Laporan
                    </button>
                    <button class="tab-link flex-1 whitespace-nowrap py-3 px-4 text-center border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 admin-only" data-tab="pengaturan">
                        <i class="ri-settings-line mr-1"></i> Pengaturan
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content Container -->
        <div id="content" class="mb-20">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active slide-up">
                <div class="mb-8">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Ringkasan Keuangan</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Saldo</p>
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white" id="total-balance">Rp 2.500.000</h3>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/20 p-2 rounded-full">
                                    <i class="ri-wallet-3-line text-blue-500 dark:text-blue-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Pemasukan</p>
                                    <h3 class="text-2xl font-bold text-green-600 dark:text-green-400" id="total-income">Rp 4.000.000</h3>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/20 p-2 rounded-full">
                                    <i class="ri-arrow-up-circle-line text-green-500 dark:text-green-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Pengeluaran</p>
                                    <h3 class="text-2xl font-bold text-red-600 dark:text-red-400" id="total-expense">Rp 1.500.000</h3>
                                </div>
                                <div class="bg-red-100 dark:bg-red-900/20 p-2 rounded-full">
                                    <i class="ri-arrow-down-circle-line text-red-500 dark:text-red-400 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="md:col-span-2 bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Aktivitas Terbaru</h3>
                            <div class="flex items-center">
                                <button id="prev-month" class="text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary">
                                    <i class="ri-arrow-left-s-line text-lg"></i>
                                </button>
                                <span id="current-month" class="mx-2 text-sm text-gray-600 dark:text-gray-300">Juli 2023</span>
                                <button id="next-month" class="text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary">
                                    <i class="ri-arrow-right-s-line text-lg"></i>
                                </button>
                            </div>
                        </div>
                        <div class="h-60">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Distribusi Pengeluaran</h3>
                        <div class="h-60">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Transaksi Terbaru</h3>
                            <div class="flex space-x-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-1">
                                <button class="filter-tab py-1 px-3 text-xs rounded-md active" data-filter="all">Semua</button>
                                <button class="filter-tab py-1 px-3 text-xs rounded-md" data-filter="today">Hari Ini</button>
                                <button class="filter-tab py-1 px-3 text-xs rounded-md" data-filter="month">Bulan Ini</button>
                                <button class="filter-tab py-1 px-3 text-xs rounded-md" data-filter="year">Tahun Ini</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Deskripsi</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="recent-transactions">
                                    <!-- Recent transactions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-center">
                            <button class="text-primary hover:text-primaryDark dark:text-primary dark:hover:text-primaryDark text-sm font-medium transition-colors" data-tab="transaksi" id="view-all-transactions">
                                Lihat Semua Transaksi
                            </button>
                        </div>
                    </div>
                    
                    <!-- Admin View: Status Iuran Penghuni -->
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 admin-view">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Status Iuran Penghuni</h3>
                        <div class="space-y-4" id="resident-dues-status">
                            <!-- Resident dues will be populated here -->
                        </div>
                        <div class="mt-4 text-center">
                            <button class="text-primary hover:text-primaryDark dark:text-primary dark:hover:text-primaryDark text-sm font-medium transition-colors admin-only" data-tab="penghuni" id="view-all-residents">
                                Kelola Penghuni
                            </button>
                        </div>
                    </div>
                    
                    <!-- Penghuni View: Status Iuran Pribadi -->
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 resident-view hidden">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Status Iuran Pribadi</h3>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <div>
                                    <p class="text-sm font-medium text-gray-800 dark:text-white">Iuran Bulan Ini</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Juli 2023</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm font-medium text-green-600 dark:text-green-400">
                                        Lunas
                                    </span>
                                    <div class="h-3 w-3 rounded-full bg-green-500"></div>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h4 class="text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300">Riwayat Pembayaran</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded">
                                        <div>
                                            <p class="text-sm text-gray-700 dark:text-gray-300">Juli 2023</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Dibayar pada 01/07/2023</p>
                                        </div>
                                        <span class="text-green-600 dark:text-green-400 text-sm font-medium">Rp 500.000</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded">
                                        <div>
                                            <p class="text-sm text-gray-700 dark:text-gray-300">Juni 2023</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Dibayar pada 02/06/2023</p>
                                        </div>
                                        <span class="text-green-600 dark:text-green-400 text-sm font-medium">Rp 500.000</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-800 p-2 rounded">
                                        <div>
                                            <p class="text-sm text-gray-700 dark:text-gray-300">Mei 2023</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Dibayar pada 03/05/2023</p>
                                        </div>
                                        <span class="text-green-600 dark:text-green-400 text-sm font-medium">Rp 500.000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Pengingat</h3>
                        <button id="add-reminder" class="text-primary hover:text-primaryDark dark:text-primary dark:hover:text-primaryDark text-sm font-medium transition-colors admin-only">
                            <i class="ri-add-line mr-1"></i> Tambah Pengingat
                        </button>
                    </div>
                    <div class="space-y-3" id="reminders-list">
                        <!-- Reminders will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Transaksi Tab -->
            <div id="transaksi" class="tab-content slide-up">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="md:col-span-2">
                        <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Daftar Transaksi</h2>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 mb-6">
                            <div class="flex flex-wrap items-center justify-between mb-4">
                                <div class="flex items-center space-x-2 mb-2 sm:mb-0">
                                    <div class="relative">
                                        <input type="text" id="search-transaction" class="pl-10 pr-4 py-2 w-full sm:w-64 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Cari transaksi...">
                                        <div class="absolute left-3 top-2.5 text-gray-400">
                                            <i class="ri-search-line text-lg"></i>
                                        </div>
                                    </div>
                                    <select id="filter-transaction" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                        <option value="all">Semua</option>
                                        <option value="income">Pemasukan</option>
                                        <option value="expense">Pengeluaran</option>
                                    </select>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="export-transactions" class="flex items-center py-2 px-4 rounded-lg bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors admin-only">
                                        <i class="ri-download-line mr-2"></i> Export
                                    </button>
                                    <!-- <button id="add-transaction-btn" class="flex items-center py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors admin-only">
                                        <i class="ri-add-line mr-2"></i> Tambah Transaksi
                                    </button> -->
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tanggal</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Kategori</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Deskripsi</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Jumlah</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider admin-only">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="transactions-list">
                                        <!-- Transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    Menampilkan <span id="shown-transactions">1-10</span> dari <span id="total-transactions">50</span> transaksi
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="prev-page" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50">
                                        <i class="ri-arrow-left-s-line"></i>
                                    </button>
                                    <span id="current-page" class="text-sm text-gray-600 dark:text-gray-300">Halaman 1</span>
                                    <button id="next-page" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50">
                                        <i class="ri-arrow-right-s-line"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admin-only">
                        <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Tambah Transaksi</h2>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <form id="transaction-form">
                                <input type="hidden" id="transaction-id" value="">
                                <div class="mb-4">
                                    <label for="transaction-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Jenis Transaksi</label>
                                    <div class="flex space-x-2">
                                        <label class="flex-1 cursor-pointer">
                                            <input type="radio" name="transaction-type" value="income" class="sr-only" checked>
                                            <div class="py-2 text-center rounded-lg border-2 border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 transition-colors">
                                                <i class="ri-arrow-up-circle-line mr-1"></i> Pemasukan
                                            </div>
                                        </label>
                                        <label class="flex-1 cursor-pointer">
                                            <input type="radio" name="transaction-type" value="expense" class="sr-only">
                                            <div class="py-2 text-center rounded-lg border-2 border-transparent bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                                                <i class="ri-arrow-down-circle-line mr-1"></i> Pengeluaran
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="transaction-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tanggal</label>
                                    <input type="date" id="transaction-date" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                                </div>
                                <div class="mb-4">
                                    <label for="transaction-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Jumlah (Rp)</label>
                                    <input type="number" id="transaction-amount" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="0" min="0" required>
                                </div>
                                <div class="mb-4">
                                    <label for="transaction-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Kategori</label>
                                    <select id="transaction-category" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                                        <optgroup label="Pemasukan" id="income-categories">
                                            <option value="iuran">Iuran Penghuni</option>
                                            <option value="sumbangan">Sumbangan</option>
                                            <option value="lainnya-income">Lainnya</option>
                                        </optgroup>
                                        <optgroup label="Pengeluaran" id="expense-categories" disabled>
                                            <option value="makanan">Makanan</option>
                                            <option value="listrik">Listrik</option>
                                            <option value="air">Air</option>
                                            <option value="internet">Internet</option>
                                            <option value="kebersihan">Kebersihan</option>
                                            <option value="perawatan">Perawatan Rumah</option>
                                            <option value="hiburan">Hiburan</option>
                                            <option value="transportasi">Transportasi</option>
                                            <option value="lainnya-expense">Lainnya</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label for="transaction-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Deskripsi</label>
                                    <textarea id="transaction-description" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" rows="2" placeholder="Tambahkan deskripsi (opsional)"></textarea>
                                </div>
                                <div id="resident-selector" class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Penghuni Terkait</label>
                                    <div class="grid grid-cols-2 gap-2" id="resident-checkboxes">
                                        <!-- Resident checkboxes will be populated here -->
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label for="transaction-split-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Metode Pembagian</label>
                                    <select id="transaction-split-type" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                        <option value="equal">Sama Rata</option>
                                        <option value="percentage">Berdasarkan Persentase</option>
                                        <option value="exact">Jumlah Spesifik</option>
                                    </select>
                                </div>
                                <div id="custom-split-container" class="mb-4 hidden">
                                    <!-- Custom split inputs will be populated here -->
                                </div>
                                <div class="flex justify-end space-x-2">
                                    <button type="button" id="reset-transaction" class="py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Reset
                                    </button>
                                    <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                        <span id="transaction-submit-text">Tambah Transaksi</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Resident View: User Transactions Info Card -->
                    <div class="resident-view hidden">
                        <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Ringkasan Transaksi Pribadi</h2>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <div class="flex flex-col space-y-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500 dark:text-blue-400 mr-4">
                                        <i class="ri-money-dollar-circle-line text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Kontribusi Bulan Ini</h3>
                                        <p class="text-lg font-bold text-gray-900 dark:text-white">Rp 500.000</p>
                                    </div>
                                </div>
                                
                                <div class="mt-2">
                                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pengeluaran oleh Kategori (Juli 2023)</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Makanan</span>
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Rp 125.000</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Listrik</span>
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Rp 87.500</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Air</span>
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Rp 75.000</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Internet</span>
                                            <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Rp 50.000</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="pt-3 border-t border-gray-200 dark:border-gray-700 mt-1">
                                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status Pembayaran</h4>
                                    <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
                                        <div class="flex items-center">
                                            <i class="ri-check-line text-green-500 dark:text-green-400 mr-2"></i>
                                            <div>
                                                <p class="text-sm font-medium text-green-800 dark:text-green-300">Lunas untuk bulan Juli 2023</p>
                                                <p class="text-xs text-green-600 dark:text-green-400">Dibayar pada 01/07/2023</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Penghuni Tab -->
            <div id="penghuni" class="tab-content slide-up admin-only">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Daftar Penghuni</h2>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 mb-6">
                            <div class="flex flex-wrap items-center justify-between mb-4">
                                <div class="relative mb-2 sm:mb-0">
                                    <input type="text" id="search-resident" class="pl-10 pr-4 py-2 w-full sm:w-64 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Cari penghuni...">
                                    <div class="absolute left-3 top-2.5 text-gray-400">
                                        <i class="ri-search-line text-lg"></i>
                                    </div>
                                </div>
                                <!-- <button id="add-resident-btn" class="flex items-center py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                    <i class="ri-user-add-line mr-2"></i> Tambah Penghuni
                                </button> -->
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nama</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Kamar</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status Iuran</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Saldo</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="residents-list">
                                        <!-- Residents will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white" id="resident-form-title">Tambah Penghuni</h2>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <form id="resident-form">
                                <input type="hidden" id="resident-id">
                                <div class="mb-4">
                                    <label for="resident-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Lengkap</label>
                                    <input type="text" id="resident-name" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                                </div>
                                <div class="mb-4">
                                    <label for="resident-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                                    <input type="email" id="resident-email" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                </div>
                                <div class="mb-4">
                                    <label for="resident-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nomor Telepon</label>
                                    <input type="tel" id="resident-phone" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                </div>
                                <div class="mb-4">
                                    <label for="resident-room" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nomor Kamar</label>
                                    <input type="text" id="resident-room" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                                </div>
                                <div class="mb-4">
                                    <label for="resident-join-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tanggal Masuk</label>
                                    <input type="date" id="resident-join-date" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                                </div>
                                <div class="mb-4">
                                    <label for="resident-dues" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Iuran Bulanan (Rp)</label>
                                    <input type="number" id="resident-dues" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" min="0" required>
                                </div>
                                <div class="mb-4">
                                    <label for="resident-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Catatan</label>
                                    <textarea id="resident-notes" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" rows="2"></textarea>
                                </div>
                                <div class="flex justify-end space-x-2">
                                    <button type="button" id="reset-resident" class="py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Reset
                                    </button>
                                    <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                        <span id="resident-submit-text">Tambah Penghuni</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Laporan Tab -->
            <div id="laporan" class="tab-content slide-up">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Laporan Keuangan</h2>
                <div class="mb-6 bg-white dark:bg-darkCard rounded-lg shadow p-4">
                    <div class="flex flex-wrap items-center justify-between mb-4">
                        <div class="flex flex-wrap items-center space-x-2 mb-2 sm:mb-0">
                            <select id="report-type" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="monthly">Laporan Bulanan</option>
                                <option value="quarterly">Laporan Triwulan</option>
                                <option value="yearly">Laporan Tahunan</option>
                                <option value="custom">Periode Kustom</option>
                            </select>
                            <select id="report-month" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7" selected>Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                            <select id="report-year" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="2023" selected>2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                            </select>
                            <div id="custom-date-range" class="hidden flex space-x-2">
                                <input type="date" id="report-start-date" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <span class="self-center text-gray-500 dark:text-gray-400">hingga</span>
                                <input type="date" id="report-end-date" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="generate-report" class="flex items-center py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                <i class="ri-file-chart-line mr-2"></i> Buat Laporan
                            </button>
                            <button id="export-report" class="flex items-center py-2 px-4 rounded-lg bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors admin-only">
                                <i class="ri-download-line mr-2"></i> Export
                            </button>
                        </div>
                    </div>
                </div>

                <div id="report-result" class="mb-6 hidden">
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white" id="report-title">Laporan Bulanan - Juli 2023</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Total Pemasukan</p>
                                <h4 class="text-xl font-bold text-green-600 dark:text-green-400" id="report-income">Rp 4.000.000</h4>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Total Pengeluaran</p>
                                <h4 class="text-xl font-bold text-red-600 dark:text-red-400" id="report-expense">Rp 1.500.000</h4>
                            </div>
                            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Saldo Akhir</p>
                                <h4 class="text-xl font-bold text-blue-600 dark:text-blue-400" id="report-balance">Rp 2.500.000</h4>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <h4 class="text-md font-semibold mb-3 text-gray-800 dark:text-white">Grafik Pemasukan dan Pengeluaran</h4>
                                <div class="h-64 w-full">
                                    <canvas id="reportIncomeExpenseChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold mb-3 text-gray-800 dark:text-white">Distribusi Kategori Pengeluaran</h4>
                                <div class="h-64 w-full">
                                    <canvas id="reportCategoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-md font-semibold mb-3 text-gray-800 dark:text-white">Detail Transaksi</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tanggal</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Kategori</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Deskripsi</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700" id="report-transactions">
                                        <!-- Report transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View: Detailed Reports -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 admin-view">
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Tren Keuangan</h3>
                        <div class="mb-3">
                            <select id="trend-period" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="6months">6 Bulan Terakhir</option>
                                <option value="1year">1 Tahun Terakhir</option>
                                <option value="2years">2 Tahun Terakhir</option>
                            </select>
                        </div>
                        <div class="h-64 w-full">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Analisis Pengeluaran Per Penghuni</h3>
                        <div class="mb-3">
                            <select id="resident-expense-period" class="py-2 px-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="current-month">Bulan Ini</option>
                                <option value="last-month">Bulan Lalu</option>
                                <option value="3months">3 Bulan Terakhir</option>
                                <option value="6months">6 Bulan Terakhir</option>
                            </select>
                        </div>
                        <div class="h-64 w-full">
                            <canvas id="residentExpenseChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Resident View: Personal Reports -->
                <div class="resident-view hidden">
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Riwayat Iuran Pribadi</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Periode</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tanggal Bayar</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Jumlah</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">Juli 2023</td>
                                        <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">01/07/2023</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-gray-800 dark:text-white">Rp 500.000</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-center">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">Lunas</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">Juni 2023</td>
                                        <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">02/06/2023</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-gray-800 dark:text-white">Rp 500.000</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-center">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">Lunas</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">Mei 2023</td>
                                        <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">03/05/2023</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-gray-800 dark:text-white">Rp 500.000</td>
                                        <td class="px-4 py-3 whitespace-nowrap text-sm text-center">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">Lunas</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Kontribusi Pengeluaran</h3>
                        <div class="mb-6">
                            <div class="h-64 w-full">
                                <canvas id="residentPersonalExpenseChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-md font-semibold mb-3 text-gray-800 dark:text-white">Pengeluaran Terbagi Bulan Ini</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                    <div>
                                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300">Listrik</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">05/07/2023</p>
                                    </div>
                                    <p class="text-sm font-medium text-red-600 dark:text-red-400">Rp 87.500</p>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                    <div>
                                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300">Air</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">10/07/2023</p>
                                    </div>
                                    <p class="text-sm font-medium text-red-600 dark:text-red-400">Rp 75.000</p>
                                </div>
                                <div class="flex justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                    <div>
                                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300">Makanan</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">25/07/2023</p>
                                    </div>
                                    <p class="text-sm font-medium text-red-600 dark:text-red-400">Rp 87.500</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pengaturan Tab -->
            <div id="pengaturan" class="tab-content slide-up admin-only">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Pengaturan</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Informasi Mess/Asrama</h3>
                        <form id="mess-info-form">
                            <div class="mb-4">
                                <label for="mess-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Mess/Asrama</label>
                                <input type="text" id="mess-name" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="Asrama Bahagia">
                            </div>
                            <div class="mb-4">
                                <label for="mess-address" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Alamat</label>
                                <textarea id="mess-address" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" rows="2">Jl. Merdeka No. 123, Jakarta</textarea>
                            </div>
                            <div class="mb-4">
                                <label for="mess-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email Kontak</label>
                                <input type="email" id="mess-email" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="info@asramabahagia.com">
                            </div>
                            <div class="mb-4">
                                <label for="mess-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Telepon Kontak</label>
                                <input type="tel" id="mess-phone" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="021-5551234">
                            </div>
                            <div class="mb-4">
                                <label for="admin-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Administrator</label>
                                <input type="text" id="admin-name" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="Admin">
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                    Simpan Perubahan
                                </button>
                            </div>
                        </form>
                    </div>
                    <div>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4 mb-6">
                            <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Pengaturan Kategori</h3>
                            <div class="mb-4">
                                <h4 class="text-md font-medium mb-2 text-gray-700 dark:text-gray-300">Kategori Pemasukan</h4>
                                <div id="income-category-list" class="space-y-2 mb-2">
                                    <!-- Income categories will be dynamically added here -->
                                </div>
                                <div class="flex">
                                    <input type="text" id="new-income-category" class="flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Kategori baru...">
                                    <button id="add-income-category" class="bg-primary text-white px-3 py-2 rounded-r-lg hover:bg-primaryDark transition-colors">
                                        <i class="ri-add-line"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-medium mb-2 text-gray-700 dark:text-gray-300">Kategori Pengeluaran</h4>
                                <div id="expense-category-list" class="space-y-2 mb-2">
                                    <!-- Expense categories will be dynamically added here -->
                                </div>
                                <div class="flex">
                                    <input type="text" id="new-expense-category" class="flex-1 rounded-l-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Kategori baru...">
                                    <button id="add-expense-category" class="bg-primary text-white px-3 py-2 rounded-r-lg hover:bg-primaryDark transition-colors">
                                        <i class="ri-add-line"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-darkCard rounded-lg shadow p-4">
                            <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Preferensi Aplikasi</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="flex items-center cursor-pointer">
                                        <div class="relative">
                                            <input type="checkbox" id="theme-preference" class="sr-only">
                                            <div class="block bg-gray-300 dark:bg-gray-600 w-14 h-8 rounded-full"></div>
                                            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-200" style="transform: translateX(0)"></div>
                                        </div>
                                        <div class="ml-3 text-gray-700 dark:text-gray-300">
                                            Mode Gelap
                                        </div>
                                    </label>
                                </div>
                                <div>
                                    <label class="flex items-center cursor-pointer">
                                        <div class="relative">
                                            <input type="checkbox" id="notification-preference" class="sr-only" checked>
                                            <div class="block bg-gray-300 dark:bg-gray-600 w-14 h-8 rounded-full"></div>
                                            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-200" style="transform: translateX(0)"></div>
                                        </div>
                                        <div class="ml-3 text-gray-700 dark:text-gray-300">
                                            Notifikasi
                                        </div>
                                    </label>
                                </div>
                                <div>
                                    <label for="currency-format" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Format Mata Uang</label>
                                    <select id="currency-format" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                        <option value="IDR" selected>Rupiah (Rp)</option>
                                        <option value="USD">US Dollar ($)</option>
                                        <option value="EUR">Euro ()</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="date-format" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Format Tanggal</label>
                                    <select id="date-format" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                        <option value="DD-MM-YYYY" selected>DD-MM-YYYY</option>
                                        <option value="MM-DD-YYYY">MM-DD-YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation Bar -->
        <div class="fixed bottom-0 left-0 right-0 bg-white dark:bg-darkCard shadow-lg md:hidden">
            <div class="flex justify-around">
                <button class="mobile-tab-link active py-3 px-2 text-primary" data-tab="dashboard">
                    <i class="ri-dashboard-line text-xl block"></i>
                    <span class="text-xs">Dashboard</span>
                </button>
                <button class="mobile-tab-link py-3 px-2 text-gray-500 dark:text-gray-400" data-tab="transaksi">
                    <i class="ri-exchange-funds-line text-xl block"></i>
                    <span class="text-xs">Transaksi</span>
                </button>
                <button class="mobile-tab-link py-3 px-2 text-gray-500 dark:text-gray-400 admin-only" data-tab="penghuni">
                    <i class="ri-user-line text-xl block"></i>
                    <span class="text-xs">Penghuni</span>
                </button>
                <button class="mobile-tab-link py-3 px-2 text-gray-500 dark:text-gray-400" data-tab="laporan">
                    <i class="ri-bar-chart-line text-xl block"></i>
                    <span class="text-xs">Laporan</span>
                </button>
                <button class="mobile-tab-link py-3 px-2 text-gray-500 dark:text-gray-400 admin-only" data-tab="pengaturan">
                    <i class="ri-settings-line text-xl block"></i>
                    <span class="text-xs">Pengaturan</span>
                </button>
            </div>
        </div>

        <!-- Modal Backdrop -->
        <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

        <!-- User Profile Modal -->
        <div id="user-profile-modal" class="fixed inset-0 flex items-center justify-center z-30 hidden">
            <div class="bg-white dark:bg-darkCard rounded-lg shadow-lg max-w-md w-full mx-4 fade-in slide-up">
                <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Edit Profil Pengguna</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <form id="user-profile-form">
                        <div class="mb-4">
                            <label for="profile-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Lengkap</label>
                            <input type="text" id="profile-name" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="Admin" required>
                        </div>
                        <div class="mb-4">
                            <label for="profile-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                            <input type="email" id="profile-email" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="admin@kasmess.com" required>
                        </div>
                        <div class="mb-4">
                            <label for="profile-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nomor Telepon</label>
                            <input type="tel" id="profile-phone" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" value="081234567890">
                        </div>
                        <div class="mb-4">
                            <label for="profile-role" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Peran</label>
                            <select id="profile-role" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="admin" selected>Administrator</option>
                                <option value="resident">Penghuni</option>
                            </select>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button type="button" class="close-modal py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                Simpan Perubahan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Change User Modal -->
        <div id="change-user-modal" class="fixed inset-0 flex items-center justify-center z-30 hidden">
            <div class="bg-white dark:bg-darkCard rounded-lg shadow-lg max-w-md w-full mx-4 fade-in slide-up">
                <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Ganti Pengguna</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <div class="mb-4">
                        <input type="text" id="search-user" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Cari pengguna...">
                    </div>
                    <div class="space-y-2 mb-4 max-h-60 overflow-y-auto" id="user-list">
                        <div class="flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer user-item active" data-user-id="admin" data-user-role="admin">
                            <div class="h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white mr-3">
                                <span>A</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Admin</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Administrator</p>
                            </div>
                        </div>
                        <div class="flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer user-item" data-user-id="budi" data-user-role="resident">
                            <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white mr-3">
                                <span>B</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Budi</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Penghuni</p>
                            </div>
                        </div>
                        <div class="flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer user-item" data-user-id="citra" data-user-role="resident">
                            <div class="h-10 w-10 rounded-full bg-green-500 flex items-center justify-center text-white mr-3">
                                <span>C</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Citra</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Penghuni</p>
                            </div>
                        </div>
                        <div class="flex items-center p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer user-item" data-user-id="deni" data-user-role="resident">
                            <div class="h-10 w-10 rounded-full bg-yellow-500 flex items-center justify-center text-white mr-3">
                                <span>D</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Deni</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Penghuni</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button class="close-modal py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Reminder Modal -->
        <div id="reminder-modal" class="fixed inset-0 flex items-center justify-center z-30 hidden">
            <div class="bg-white dark:bg-darkCard rounded-lg shadow-lg max-w-md w-full mx-4 fade-in slide-up">
                <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Tambah Pengingat</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <form id="reminder-form">
                        <div class="mb-4">
                            <label for="reminder-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Judul</label>
                            <input type="text" id="reminder-title" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" placeholder="Pembayaran tagihan listrik" required>
                        </div>
                        <div class="mb-4">
                            <label for="reminder-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tanggal Jatuh Tempo</label>
                            <input type="date" id="reminder-date" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                        </div>
                        <div class="mb-4">
                            <label for="reminder-priority" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Prioritas</label>
                            <select id="reminder-priority" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                                <option value="low">Rendah</option>
                                <option value="medium" selected>Sedang</option>
                                <option value="high">Tinggi</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="reminder-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Catatan</label>
                            <textarea id="reminder-notes" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" rows="2" placeholder="Detail tambahan (opsional)"></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="reminder-notify" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Kirim Notifikasi Kepada</label>
                            <select id="reminder-notify" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" multiple>
                                <option value="all" selected>Semua Penghuni</option>
                                <option value="admin">Hanya Admin</option>
                                <option value="specific">Penghuni Tertentu</option>
                            </select>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button type="button" class="close-modal py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                Simpan Pengingat
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Edit Category Modal -->
        <div id="edit-category-modal" class="fixed inset-0 flex items-center justify-center z-30 hidden">
            <div class="bg-white dark:bg-darkCard rounded-lg shadow-lg max-w-md w-full mx-4 fade-in slide-up">
                <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Edit Kategori</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <form id="edit-category-form">
                        <input type="hidden" id="edit-category-type" value="">
                        <input type="hidden" id="edit-category-index" value="">
                        <div class="mb-4">
                            <label for="edit-category-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Kategori</label>
                            <input type="text" id="edit-category-name" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base" required>
                        </div>
                        <div class="flex justify-end space-x-2 mt-4">
                            <button type="button" class="close-modal py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Batal
                            </button>
                            <button type="submit" class="py-2 px-4 rounded-lg bg-primary text-white hover:bg-primaryDark transition-colors">
                                Simpan Perubahan
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Confirm Delete Modal -->
        <div id="confirm-delete-modal" class="fixed inset-0 flex items-center justify-center z-30 hidden">
            <div class="bg-white dark:bg-darkCard rounded-lg shadow-lg max-w-md w-full mx-4 fade-in slide-up">
                <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Konfirmasi Hapus</h3>
                    <button class="close-modal text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4" id="delete-message">Apakah Anda yakin ingin menghapus item ini?</p>
                    <input type="hidden" id="delete-type" value="">
                    <input type="hidden" id="delete-id" value="">
                    <div class="flex justify-end space-x-2">
                        <button type="button" class="close-modal py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                            Batal
                        </button>
                        <button type="button" id="confirm-delete-btn" class="py-2 px-4 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors">
                            Hapus
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-20 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-xs w-full transform translate-y-10 opacity-0 transition-all hidden z-50">
            <div class="flex items-center">
                <div id="toast-icon" class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-3">
                    <i id="toast-icon-symbol" class="text-lg"></i>
                </div>
                <div class="flex-1">
                    <p id="toast-title" class="font-medium text-gray-900 dark:text-white"></p>
                    <p id="toast-message" class="text-sm text-gray-600 dark:text-gray-300"></p>
                </div>
                <button id="close-toast" class="flex-shrink-0 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="ri-close-line"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection and toggle
        function initTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-preference').checked = true;
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-preference').checked = true;
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-preference').checked = false;
                }
            });
        }

        // IIFE to initialize the app
        (function() {
            // Initialize theme
            initTheme();
            
            // Global app state
            const appState = {
                currentRole: 'admin', // 'admin' or 'resident'
                currentUser: {
                    id: 'admin',
                    name: 'Admin',
                    email: 'admin@kasmess.com',
                    role: 'admin'
                },
                transactionFilter: {
                    timeframe: 'all', // 'all', 'today', 'month', 'year'
                    searchTerm: '',
                    type: 'all' // 'all', 'income', 'expense'
                },
                editMode: {
                    transaction: false,
                    resident: false
                }
            };
            
            // Sample data (in a real app, this would come from a database)
            const today = new Date();
            let appData = {
                transactions: [
                    {
                        id: 1,
                        date: '2023-07-01',
                        type: 'income',
                        category: 'iuran',
                        amount: 2000000,
                        description: 'Iuran bulanan Juli',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 2,
                        date: '2023-07-05',
                        type: 'expense',
                        category: 'listrik',
                        amount: 500000,
                        description: 'Tagihan listrik Juli',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 3,
                        date: '2023-07-10',
                        type: 'expense',
                        category: 'air',
                        amount: 300000,
                        description: 'Tagihan air Juli',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 4,
                        date: '2023-07-15',
                        type: 'expense',
                        category: 'internet',
                        amount: 200000,
                        description: 'Tagihan internet Juli',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 5,
                        date: '2023-07-20',
                        type: 'income',
                        category: 'sumbangan',
                        amount: 500000,
                        description: 'Sumbangan dari alumni',
                        relatedResidents: []
                    },
                    {
                        id: 6,
                        date: '2023-07-25',
                        type: 'expense',
                        category: 'kebersihan',
                        amount: 150000,
                        description: 'Biaya kebersihan Juli',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 7,
                        date: '2023-07-30',
                        type: 'expense',
                        category: 'makanan',
                        amount: 350000,
                        description: 'Belanja makanan minggu terakhir',
                        relatedResidents: ['1', '2', '4']
                    },
                    {
                        id: 8,
                        date: '2023-08-01',
                        type: 'income',
                        category: 'iuran',
                        amount: 1500000,
                        description: 'Iuran bulanan Agustus (sebagian)',
                        relatedResidents: ['1', '2', '3']
                    },
                    // Tambahan transaksi untuk demonstrasi filter
                    {
                        id: 9,
                        date: new Date().toISOString().split('T')[0], // transaksi hari ini
                        type: 'expense',
                        category: 'makanan',
                        amount: 100000,
                        description: 'Makan malam bersama',
                        relatedResidents: ['1', '2', '3', '4']
                    },
                    {
                        id: 10,
                        date: new Date().toISOString().split('T')[0], // transaksi hari ini
                        type: 'income',
                        category: 'sumbangan',
                        amount: 150000,
                        description: 'Donasi kegiatan',
                        relatedResidents: []
                    }
                ],
                residents: [
                    {
                        id: '1',
                        name: 'Budi Santoso',
                        email: 'budi@example.com',
                        phone: '081234567890',
                        room: '101',
                        joinDate: '2023-01-15',
                        dues: 500000,
                        duesPaid: true,
                        notes: 'Mahasiswa Teknik'
                    },
                    {
                        id: '2',
                        name: 'Citra Dewi',
                        email: 'citra@example.com',
                        phone: '081234567891',
                        room: '102',
                        joinDate: '2023-02-01',
                        dues: 500000,
                        duesPaid: true,
                        notes: 'Mahasiswa Kedokteran'
                    },
                    {
                        id: '3',
                        name: 'Deni Pratama',
                        email: 'deni@example.com',
                        phone: '081234567892',
                        room: '103',
                        joinDate: '2023-03-01',
                        dues: 500000,
                        duesPaid: true,
                        notes: 'Karyawan Swasta'
                    },
                    {
                        id: '4',
                        name: 'Eka Putri',
                        email: 'eka@example.com',
                        phone: '081234567893',
                        room: '104',
                        joinDate: '2023-04-01',
                        dues: 500000,
                        duesPaid: false,
                        notes: 'Mahasiswa Hukum'
                    }
                ],
                reminders: [
                    {
                        id: 1,
                        title: 'Pembayaran Tagihan Listrik',
                        date: '2023-08-10',
                        priority: 'high',
                        notes: 'Jangan sampai telat pembayaran untuk menghindari denda',
                        notifyTo: 'all'
                    },
                    {
                        id: 2,
                        title: 'Pengumpulan Iuran Bulanan',
                        date: '2023-08-05',
                        priority: 'medium',
                        notes: 'Batas waktu pembayaran iuran bulan Agustus',
                        notifyTo: 'all'
                    },
                    {
                        id: 3,
                        title: 'Jadwal Bersih-bersih Bersama',
                        date: '2023-08-15',
                        priority: 'low',
                        notes: 'Kerja bakti bersama semua penghuni',
                        notifyTo: 'all'
                    }
                ],
                categories: {
                    income: ['iuran', 'sumbangan', 'lainnya-income'],
                    expense: ['makanan', 'listrik', 'air', 'internet', 'kebersihan', 'perawatan', 'hiburan', 'transportasi', 'lainnya-expense']
                }
            };
            
            // DOM element references
            const elements = {
                themeToggle: document.getElementById('theme-toggle'),
                themePreference: document.getElementById('theme-preference'),
                userMenuButton: document.getElementById('user-menu-button'),
                userDropdown: document.getElementById('user-dropdown'),
                tabLinks: document.querySelectorAll('.tab-link'),
                mobileTabLinks: document.querySelectorAll('.mobile-tab-link'),
                tabContents: document.querySelectorAll('.tab-content'),
                editProfile: document.getElementById('edit-profile'),
                changeUser: document.getElementById('change-user'),
                modalBackdrop: document.getElementById('modal-backdrop'),
                userProfileModal: document.getElementById('user-profile-modal'),
                changeUserModal: document.getElementById('change-user-modal'),
                closeModalButtons: document.querySelectorAll('.close-modal'),
                transactionForm: document.getElementById('transaction-form'),
                transactionTypeRadios: document.querySelectorAll('input[name="transaction-type"]'),
                transactionCategory: document.getElementById('transaction-category'),
                transactionSplitType: document.getElementById('transaction-split-type'),
                customSplitContainer: document.getElementById('custom-split-container'),
                residentForm: document.getElementById('resident-form'),
                resetTransaction: document.getElementById('reset-transaction'),
                resetResident: document.getElementById('reset-resident'),
                addReminderBtn: document.getElementById('add-reminder'),
                reminderModal: document.getElementById('reminder-modal'),
                reminderForm: document.getElementById('reminder-form'),
                messInfoForm: document.getElementById('mess-info-form'),
                viewAllTransactions: document.getElementById('view-all-transactions'),
                viewAllResidents: document.getElementById('view-all-residents'),
                toast: document.getElementById('toast'),
                closeToast: document.getElementById('close-toast'),
                userProfileForm: document.getElementById('user-profile-form'),
                reportType: document.getElementById('report-type'),
                reportMonth: document.getElementById('report-month'),
                reportYear: document.getElementById('report-year'),
                customDateRange: document.getElementById('custom-date-range'),
                generateReport: document.getElementById('generate-report'),
                reportResult: document.getElementById('report-result'),
                searchTransaction: document.getElementById('search-transaction'),
                filterTransaction: document.getElementById('filter-transaction'),
                searchResident: document.getElementById('search-resident'),
                adminView: document.getElementById('admin-view'),
                residentView: document.getElementById('resident-view'),
                mobileAdminView: document.getElementById('mobile-admin-view'),
                mobileResidentView: document.getElementById('mobile-resident-view'),
                roleIndicator: document.getElementById('role-indicator'),
                roleName: document.getElementById('role-name'),
                switchRoleBtn: document.getElementById('switch-role-btn'),
                filterTabs: document.querySelectorAll('.filter-tab'),
                editCategoryModal: document.getElementById('edit-category-modal'),
                editCategoryForm: document.getElementById('edit-category-form'),
                confirmDeleteModal: document.getElementById('confirm-delete-modal'),
                confirmDeleteBtn: document.getElementById('confirm-delete-btn'),
                addIncomeCategory: document.getElementById('add-income-category'),
                addExpenseCategory: document.getElementById('add-expense-category'),
                incomeCategoryList: document.getElementById('income-category-list'),
                expenseCategoryList: document.getElementById('expense-category-list')
            };

            // Format currency
            function formatCurrency(amount) {
                return 'Rp ' + amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            }
            
            // Format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }

            // Initialize Dashboard Charts
            function initDashboardCharts() {
                try {
                    // Cash Flow Chart
                    const cashFlowCtx = document.getElementById('cashFlowChart');
                    if (cashFlowCtx) {
                        const cashFlowChart = new Chart(cashFlowCtx.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['1 Jul', '5 Jul', '10 Jul', '15 Jul', '20 Jul', '25 Jul', '30 Jul'],
                                datasets: [
                                    {
                                        label: 'Pemasukan',
                                        data: [2000000, 0, 0, 0, 500000, 0, 0],
                                        borderColor: '#10B981',
                                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    },
                                    {
                                        label: 'Pengeluaran',
                                        data: [0, 500000, 300000, 200000, 0, 150000, 350000],
                                        borderColor: '#EF4444',
                                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return 'Rp ' + (value / 1000) + 'K';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // Expense Chart
                    const expenseCtx = document.getElementById('expenseChart');
                    if (expenseCtx) {
                        const expenseChart = new Chart(expenseCtx.getContext('2d'), {
                            type: 'doughnut',
                            data: {
                                labels: ['Listrik', 'Air', 'Internet', 'Kebersihan', 'Makanan'],
                                datasets: [{
                                    data: [500000, 300000, 200000, 150000, 350000],
                                    backgroundColor: [
                                        '#3B82F6',
                                        '#10B981',
                                        '#F59E0B',
                                        '#8B5CF6',
                                        '#EC4899'
                                    ],
                                    hoverOffset: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // Personal expense chart (resident view)
                    const residentPersonalExpenseCtx = document.getElementById('residentPersonalExpenseChart');
                    if (residentPersonalExpenseCtx) {
                        const residentPersonalExpenseChart = new Chart(residentPersonalExpenseCtx.getContext('2d'), {
                            type: 'pie',
                            data: {
                                labels: ['Listrik', 'Air', 'Internet', 'Makanan', 'Kebersihan'],
                                datasets: [{
                                    data: [87500, 75000, 50000, 125000, 37500],
                                    backgroundColor: [
                                        '#3B82F6',
                                        '#10B981',
                                        '#F59E0B',
                                        '#EC4899',
                                        '#8B5CF6'
                                    ],
                                    hoverOffset: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error initializing dashboard charts:', error);
                }
            }

            // Initialize Report Charts
            function initReportCharts() {
                try {
                    // Report Income Expense Chart
                    const reportIncomeExpenseCtx = document.getElementById('reportIncomeExpenseChart');
                    if (reportIncomeExpenseCtx) {
                        const reportIncomeExpenseChart = new Chart(reportIncomeExpenseCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Minggu 1', 'Minggu 2', 'Minggu 3', 'Minggu 4'],
                                datasets: [
                                    {
                                        label: 'Pemasukan',
                                        data: [2000000, 0, 500000, 0],
                                        backgroundColor: '#10B981',
                                    },
                                    {
                                        label: 'Pengeluaran',
                                        data: [500000, 500000, 150000, 350000],
                                        backgroundColor: '#EF4444',
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return 'Rp ' + (value / 1000) + 'K';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // Report Category Chart
                    const reportCategoryCtx = document.getElementById('reportCategoryChart');
                    if (reportCategoryCtx) {
                        const reportCategoryChart = new Chart(reportCategoryCtx.getContext('2d'), {
                            type: 'pie',
                            data: {
                                labels: ['Listrik', 'Air', 'Internet', 'Kebersihan', 'Makanan'],
                                datasets: [{
                                    data: [500000, 300000, 200000, 150000, 350000],
                                    backgroundColor: [
                                        '#3B82F6',
                                        '#10B981',
                                        '#F59E0B',
                                        '#8B5CF6',
                                        '#EC4899'
                                    ],
                                    hoverOffset: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // Trend Chart
                    const trendCtx = document.getElementById('trendChart');
                    if (trendCtx) {
                        const trendChart = new Chart(trendCtx.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: ['Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul'],
                                datasets: [
                                    {
                                        label: 'Pemasukan',
                                        data: [2200000, 2500000, 2300000, 2100000, 2400000, 2500000],
                                        borderColor: '#10B981',
                                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    },
                                    {
                                        label: 'Pengeluaran',
                                        data: [1800000, 2000000, 1700000, 1900000, 1600000, 1500000],
                                        borderColor: '#EF4444',
                                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    },
                                    {
                                        label: 'Saldo',
                                        data: [400000, 500000, 600000, 200000, 800000, 1000000],
                                        borderColor: '#3B82F6',
                                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                        tension: 0.4,
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            font: {
                                                size: 12
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return 'Rp ' + (value / 1000000).toFixed(1) + 'M';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // Resident Expense Chart
                    const residentExpenseCtx = document.getElementById('residentExpenseChart');
                    if (residentExpenseCtx) {
                        const residentExpenseChart = new Chart(residentExpenseCtx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: ['Budi', 'Citra', 'Deni', 'Eka'],
                                datasets: [{
                                    label: 'Biaya per Penghuni',
                                    data: [375000, 375000, 375000, 375000],
                                    backgroundColor: '#5D5CDE',
                                    borderWidth: 0,
                                    borderRadius: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return 'Rp ' + (value / 1000) + 'K';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error initializing report charts:', error);
                }
            }

            // Switch between admin and resident roles
            function switchRole(role) {
                // Update state
                appState.currentRole = role;
                appState.currentUser.role = role;
                
                // Update UI based on role
                if (role === 'admin') {
                    document.querySelectorAll('.admin-view').forEach(el => el.classList.remove('hidden'));
                    document.querySelectorAll('.resident-view').forEach(el => el.classList.add('hidden'));
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
                    
                    // Update role indicator
                    document.getElementById('role-name').textContent = 'Administrator';
                    document.getElementById('switch-role-btn').textContent = 'Ganti ke Mode Penghuni';
                    document.getElementById('user-role-display').textContent = 'Administrator';
                    
                    // Update buttons
                    document.getElementById('admin-view').classList.add('bg-primary', 'text-white');
                    document.getElementById('admin-view').classList.remove('text-gray-700', 'dark:text-gray-300');
                    document.getElementById('resident-view').classList.remove('bg-primary', 'text-white');
                    document.getElementById('resident-view').classList.add('text-gray-700', 'dark:text-gray-300');
                } else {
                    document.querySelectorAll('.admin-view').forEach(el => el.classList.add('hidden'));
                    document.querySelectorAll('.resident-view').forEach(el => el.classList.remove('hidden'));
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
                    
                    // Update role indicator
                    document.getElementById('role-name').textContent = 'Penghuni';
                    document.getElementById('switch-role-btn').textContent = 'Ganti ke Mode Admin';
                    document.getElementById('user-role-display').textContent = 'Penghuni';
                    
                    // Update buttons
                    document.getElementById('admin-view').classList.remove('bg-primary', 'text-white');
                    document.getElementById('admin-view').classList.add('text-gray-700', 'dark:text-gray-300');
                    document.getElementById('resident-view').classList.add('bg-primary', 'text-white');
                    document.getElementById('resident-view').classList.remove('text-gray-700', 'dark:text-gray-300');
                    
                    // Check if a resident-only tab is active
                    const activeTab = document.querySelector('.tab-link.active');
                    if (activeTab && (activeTab.dataset.tab === 'penghuni' || activeTab.dataset.tab === 'pengaturan')) {
                        // Switch to dashboard if current tab is admin-only
                        document.querySelector('.tab-link[data-tab="dashboard"]').click();
                    }
                }
                
                // Update charts and tables
                initDashboardCharts();
                populateAllTransactions();
                
                // Close dropdown menu
                document.getElementById('user-dropdown').classList.add('hidden');
                
                // Show toast notification
                showToast('Peran Diubah', `Anda sekarang melihat sebagai ${role === 'admin' ? 'Administrator' : 'Penghuni'}`, 'info');
            }

            // Filter transactions based on search term, type, and timeframe
            function filterTransactions() {
                const { searchTerm, type, timeframe } = appState.transactionFilter;
                
                // Filter by search term (search in description)
                let filtered = appData.transactions;
                
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    filtered = filtered.filter(t => {
                        return t.description.toLowerCase().includes(searchLower) || 
                               t.category.toLowerCase().includes(searchLower);
                    });
                }
                
                // Filter by transaction type
                if (type !== 'all') {
                    filtered = filtered.filter(t => t.type === type);
                }
                
                // Filter by timeframe
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().split('T')[0];
                const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
                const firstDayOfYear = new Date(now.getFullYear(), 0, 1).toISOString().split('T')[0];
                
                if (timeframe === 'today') {
                    filtered = filtered.filter(t => t.date === today);
                } else if (timeframe === 'month') {
                    filtered = filtered.filter(t => t.date >= firstDayOfMonth);
                } else if (timeframe === 'year') {
                    filtered = filtered.filter(t => t.date >= firstDayOfYear);
                }
                
                return filtered;
            }

            // Populate Recent Transactions in Dashboard
            function populateRecentTransactions() {
                const recentTransactionsContainer = document.getElementById('recent-transactions');
                if (!recentTransactionsContainer) return;
                
                recentTransactionsContainer.innerHTML = '';

                // Apply current filters before getting recent transactions
                const filteredTransactions = filterTransactions();
                
                // Get the 5 most recent transactions after filtering
                const recentTransactions = [...filteredTransactions]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);

                if (recentTransactions.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = 3;
                    td.className = 'px-4 py-3 text-center text-sm text-gray-500 dark:text-gray-400';
                    td.textContent = 'Tidak ada transaksi yang ditemukan';
                    tr.appendChild(td);
                    recentTransactionsContainer.appendChild(tr);
                    return;
                }

                recentTransactions.forEach(transaction => {
                    const tr = document.createElement('tr');
                    
                    const tdDate = document.createElement('td');
                    tdDate.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300';
                    tdDate.textContent = formatDate(transaction.date);
                    
                    const tdDesc = document.createElement('td');
                    tdDesc.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
                    tdDesc.textContent = transaction.description;
                    
                    const tdAmount = document.createElement('td');
                    tdAmount.className = 'px-4 py-3 whitespace-nowrap text-sm text-right font-medium ' + 
                        (transaction.type === 'income' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400');
                    tdAmount.textContent = (transaction.type === 'income' ? '+ ' : '- ') + formatCurrency(transaction.amount);
                    
                    tr.appendChild(tdDate);
                    tr.appendChild(tdDesc);
                    tr.appendChild(tdAmount);
                    
                    recentTransactionsContainer.appendChild(tr);
                });
            }

            // Populate Resident Dues Status in Dashboard
            function populateResidentDues() {
                const residentDuesContainer = document.getElementById('resident-dues-status');
                if (!residentDuesContainer) return;
                
                residentDuesContainer.innerHTML = '';

                appData.residents.forEach(resident => {
                    const div = document.createElement('div');
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm font-medium text-gray-800 dark:text-white">${resident.name}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Kamar ${resident.room}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium ${resident.duesPaid ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">
                                    ${resident.duesPaid ? 'Lunas' : 'Belum Lunas'}
                                </span>
                                <div class="h-3 w-3 rounded-full ${resident.duesPaid ? 'bg-green-500' : 'bg-red-500'}"></div>
                            </div>
                        </div>
                    `;
                    
                    residentDuesContainer.appendChild(div);
                });
            }

            // Populate Reminders
            function populateReminders() {
                const remindersContainer = document.getElementById('reminders-list');
                if (!remindersContainer) return;
                
                remindersContainer.innerHTML = '';

                appData.reminders.forEach(reminder => {
                    const div = document.createElement('div');
                    div.className = 'flex items-start p-3 rounded-lg ' + getPriorityBgClass(reminder.priority);
                    
                    let iconClass = 'ri-alarm-warning-line';
                    if (reminder.priority === 'low') iconClass = 'ri-alarm-line';
                    if (reminder.priority === 'high') iconClass = 'ri-alarm-warning-fill';
                    
                    div.innerHTML = `
                        <div class="flex-shrink-0 mr-3">
                            <i class="${iconClass} text-lg ${getPriorityTextClass(reminder.priority)}"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h4 class="text-sm font-medium text-gray-800 dark:text-white">${reminder.title}</h4>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${formatDate(reminder.date)}</div>
                            </div>
                            <p class="text-xs text-gray-600 dark:text-gray-300 mt-1">${reminder.notes}</p>
                        </div>
                    `;
                    
                    remindersContainer.appendChild(div);
                });
            }

            function getPriorityBgClass(priority) {
                switch (priority) {
                    case 'high': return 'bg-red-50 dark:bg-red-900/20';
                    case 'medium': return 'bg-yellow-50 dark:bg-yellow-900/20';
                    case 'low': return 'bg-green-50 dark:bg-green-900/20';
                    default: return 'bg-gray-50 dark:bg-gray-800';
                }
            }

            function getPriorityTextClass(priority) {
                switch (priority) {
                    case 'high': return 'text-red-600 dark:text-red-400';
                    case 'medium': return 'text-yellow-600 dark:text-yellow-400';
                    case 'low': return 'text-green-600 dark:text-green-400';
                    default: return 'text-gray-600 dark:text-gray-400';
                }
            }

            // Populate All Transactions
            function populateAllTransactions() {
                const transactionsContainer = document.getElementById('transactions-list');
                if (!transactionsContainer) return;
                
                transactionsContainer.innerHTML = '';

                // Apply filters to transactions
                const filteredTransactions = filterTransactions();
                
                // Sort filtered transactions by date (newest first)
                const sortedTransactions = [...filteredTransactions].sort((a, b) => new Date(b.date) - new Date(a.date));

                if (sortedTransactions.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    const colSpan = appState.currentRole === 'admin' ? 5 : 4;
                    td.colSpan = colSpan;
                    td.className = 'px-4 py-3 text-center text-sm text-gray-500 dark:text-gray-400';
                    td.textContent = 'Tidak ada transaksi yang ditemukan';
                    tr.appendChild(td);
                    transactionsContainer.appendChild(tr);
                    
                    // Update pagination info
                    document.getElementById('shown-transactions').textContent = '0';
                    document.getElementById('total-transactions').textContent = '0';
                    return;
                }

                sortedTransactions.forEach(transaction => {
                    const tr = document.createElement('tr');
                    
                    const tdDate = document.createElement('td');
                    tdDate.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300';
                    tdDate.textContent = formatDate(transaction.date);
                    
                    const tdCategory = document.createElement('td');
                    tdCategory.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
                    const categoryName = transaction.category.charAt(0).toUpperCase() + transaction.category.slice(1);
                    tdCategory.innerHTML = `
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            transaction.type === 'income' 
                                ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' 
                                : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                        }">
                            ${categoryName}
                        </span>
                    `;
                    
                    const tdDesc = document.createElement('td');
                    tdDesc.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
                    tdDesc.textContent = transaction.description;
                    
                    const tdAmount = document.createElement('td');
                    tdAmount.className = 'px-4 py-3 whitespace-nowrap text-sm text-right font-medium ' + 
                        (transaction.type === 'income' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400');
                    tdAmount.textContent = (transaction.type === 'income' ? '+ ' : '- ') + formatCurrency(transaction.amount);
                    
                    tr.appendChild(tdDate);
                    tr.appendChild(tdCategory);
                    tr.appendChild(tdDesc);
                    tr.appendChild(tdAmount);
                    
                    // Only add action buttons for admin role
                    if (appState.currentRole === 'admin') {
                        const tdActions = document.createElement('td');
                        tdActions.className = 'px-4 py-3 whitespace-nowrap text-sm text-center';
                        tdActions.innerHTML = `
                            <div class="flex justify-center space-x-1">
                                <button class="p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary edit-transaction-btn" data-id="${transaction.id}">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button class="p-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 delete-transaction-btn" data-id="${transaction.id}">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        `;
                        tr.appendChild(tdActions);
                    }
                    
                    transactionsContainer.appendChild(tr);
                });

                // Update pagination info
                document.getElementById('shown-transactions').textContent = '1-' + Math.min(sortedTransactions.length, 10);
                document.getElementById('total-transactions').textContent = sortedTransactions.length;
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-transaction-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const transactionId = parseInt(this.dataset.id);
                        editTransaction(transactionId);
                    });
                });
                
                document.querySelectorAll('.delete-transaction-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const transactionId = parseInt(this.dataset.id);
                        showDeleteConfirmation('transaction', transactionId, 'transaksi');
                    });
                });
            }

            // Edit Transaction Function
            function editTransaction(id) {
                // Find transaction
                const transaction = appData.transactions.find(t => t.id === id);
                if (!transaction) return;
                
                // Set transaction form to edit mode
                appState.editMode.transaction = true;
                
                // Fill form with transaction data
                document.getElementById('transaction-id').value = transaction.id;
                document.querySelector(`input[name="transaction-type"][value="${transaction.type}"]`).checked = true;
                document.getElementById('transaction-date').value = transaction.date;
                document.getElementById('transaction-amount').value = transaction.amount;
                document.getElementById('transaction-description').value = transaction.description;
                
                // Update radio button UI
                document.querySelectorAll('label input[name="transaction-type"] + div').forEach(div => {
                    div.classList.add('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    div.classList.remove('border-green-500', 'border-red-500', 'bg-green-50', 'bg-red-50', 'dark:bg-green-900/20', 'dark:bg-red-900/20', 'text-green-700', 'text-red-700', 'dark:text-green-300', 'dark:text-red-300');
                });
                
                if (transaction.type === 'income') {
                    document.querySelector('input[name="transaction-type"][value="income"] + div').classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20', 'text-green-700', 'dark:text-green-300');
                    document.querySelector('input[name="transaction-type"][value="income"] + div').classList.remove('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    
                    // Enable income categories, disable expense categories
                    const incomeCategories = document.getElementById('income-categories');
                    const expenseCategories = document.getElementById('expense-categories');
                    if (incomeCategories && expenseCategories) {
                        incomeCategories.disabled = false;
                        expenseCategories.disabled = true;
                    }
                } else {
                    document.querySelector('input[name="transaction-type"][value="expense"] + div').classList.add('border-red-500', 'bg-red-50', 'dark:bg-red-900/20', 'text-red-700', 'dark:text-red-300');
                    document.querySelector('input[name="transaction-type"][value="expense"] + div').classList.remove('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    
                    // Enable expense categories, disable income categories
                    const incomeCategories = document.getElementById('income-categories');
                    const expenseCategories = document.getElementById('expense-categories');
                    if (incomeCategories && expenseCategories) {
                        incomeCategories.disabled = true;
                        expenseCategories.disabled = false;
                    }
                }
                
                // Set the correct category
                document.getElementById('transaction-category').value = transaction.category;
                
                // Check the related residents checkboxes
                document.querySelectorAll('input[name="resident-checkbox"]').forEach(checkbox => {
                    checkbox.checked = transaction.relatedResidents.includes(checkbox.value);
                });
                
                // Change the submit button text
                document.getElementById('transaction-submit-text').textContent = 'Simpan Perubahan';
                
                // Show the transaction section
                if (!document.getElementById('transaction-form').classList.contains('active')) {
                    document.querySelector('.tab-link[data-tab="transaksi"]').click();
                }
                
                // Scroll to form
                document.getElementById('transaction-form').scrollIntoView({ behavior: 'smooth' });
            }

            // Populate All Residents
            function populateAllResidents() {
                const residentsContainer = document.getElementById('residents-list');
                if (!residentsContainer) return;
                
                residentsContainer.innerHTML = '';
                
                // Get search term if any
                const searchTerm = document.getElementById('search-resident')?.value.toLowerCase() || '';
                
                // Filter residents based on search term
                let filteredResidents = appData.residents;
                if (searchTerm) {
                    filteredResidents = appData.residents.filter(resident => 
                        resident.name.toLowerCase().includes(searchTerm) || 
                        resident.email.toLowerCase().includes(searchTerm) || 
                        resident.room.toLowerCase().includes(searchTerm)
                    );
                }

                // Sort residents by room number
                const sortedResidents = [...filteredResidents].sort((a, b) => a.room.localeCompare(b.room));
                
                if (sortedResidents.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = 5;
                    td.className = 'px-4 py-3 text-center text-sm text-gray-500 dark:text-gray-400';
                    td.textContent = 'Tidak ada penghuni yang ditemukan';
                    tr.appendChild(td);
                    residentsContainer.appendChild(tr);
                    return;
                }

                sortedResidents.forEach(resident => {
                    const tr = document.createElement('tr');
                    
                    const tdName = document.createElement('td');
                    tdName.className = 'px-4 py-3 whitespace-nowrap text-sm';
                    tdName.innerHTML = `
                        <div class="flex items-center">
                            <div class="h-8 w-8 rounded-full bg-primary flex items-center justify-center text-white mr-3">
                                <span>${resident.name.charAt(0)}</span>
                            </div>
                            <div>
                                <div class="font-medium text-gray-800 dark:text-white">${resident.name}</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${resident.email}</div>
                            </div>
                        </div>
                    `;
                    
                    const tdRoom = document.createElement('td');
                    tdRoom.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300';
                    tdRoom.textContent = resident.room;
                    
                    const tdDues = document.createElement('td');
                    tdDues.className = 'px-4 py-3 whitespace-nowrap text-sm text-right';
                    tdDues.innerHTML = `
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            resident.duesPaid 
                                ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' 
                                : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                        }">
                            ${resident.duesPaid ? 'Lunas' : 'Belum Lunas'}
                        </span>
                    `;
                    
                    const tdBalance = document.createElement('td');
                    tdBalance.className = 'px-4 py-3 whitespace-nowrap text-sm text-right font-medium text-gray-800 dark:text-white';
                    tdBalance.textContent = formatCurrency(500000); // This would be calculated in a real app
                    
                    const tdActions = document.createElement('td');
                    tdActions.className = 'px-4 py-3 whitespace-nowrap text-sm text-center';
                    tdActions.innerHTML = `
                        <div class="flex justify-center space-x-1">
                            <button class="p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary edit-resident-btn" data-id="${resident.id}">
                                <i class="ri-edit-line"></i>
                            </button>
                            <button class="p-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 delete-resident-btn" data-id="${resident.id}">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    `;
                    
                    tr.appendChild(tdName);
                    tr.appendChild(tdRoom);
                    tr.appendChild(tdDues);
                    tr.appendChild(tdBalance);
                    tr.appendChild(tdActions);
                    
                    residentsContainer.appendChild(tr);
                });
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-resident-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const residentId = this.dataset.id;
                        editResident(residentId);
                    });
                });
                
                document.querySelectorAll('.delete-resident-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const residentId = this.dataset.id;
                        showDeleteConfirmation('resident', residentId, 'penghuni');
                    });
                });
            }

            // Edit Resident Function
            function editResident(id) {
                // Find resident
                const resident = appData.residents.find(r => r.id === id);
                if (!resident) return;
                
                // Set resident form to edit mode
                appState.editMode.resident = true;
                
                // Fill form with resident data
                document.getElementById('resident-id').value = resident.id;
                document.getElementById('resident-name').value = resident.name;
                document.getElementById('resident-email').value = resident.email;
                document.getElementById('resident-phone').value = resident.phone;
                document.getElementById('resident-room').value = resident.room;
                document.getElementById('resident-join-date').value = resident.joinDate;
                document.getElementById('resident-dues').value = resident.dues;
                document.getElementById('resident-notes').value = resident.notes || '';
                
                // Change the form title and submit button text
                document.getElementById('resident-form-title').textContent = 'Edit Penghuni';
                document.getElementById('resident-submit-text').textContent = 'Simpan Perubahan';
                
                // Scroll to form
                document.getElementById('resident-form').scrollIntoView({ behavior: 'smooth' });
            }

            // Populate Resident Checkboxes in Transaction Form
            function populateResidentCheckboxes() {
                const checkboxContainer = document.getElementById('resident-checkboxes');
                if (!checkboxContainer) return;
                
                checkboxContainer.innerHTML = '';

                appData.residents.forEach(resident => {
                    const label = document.createElement('label');
                    label.className = 'flex items-center space-x-2 cursor-pointer';
                    
                    label.innerHTML = `
                        <input type="checkbox" name="resident-checkbox" value="${resident.id}" class="rounded border-gray-300 text-primary focus:ring-primary dark:border-gray-600 dark:bg-gray-700">
                        <span class="text-sm text-gray-700 dark:text-gray-300">${resident.name} (${resident.room})</span>
                    `;
                    
                    checkboxContainer.appendChild(label);
                });
            }
            
            // Populate Income Categories
            function populateIncomeCategories() {
                const container = document.getElementById('income-category-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                appData.categories.income.forEach((category, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex items-center justify-between bg-gray-50 dark:bg-gray-800 p-2 rounded-lg';
                    item.innerHTML = `
                        <span class="text-gray-700 dark:text-gray-300">${category.charAt(0).toUpperCase() + category.slice(1).replace('-income', '')}</span>
                        <div class="flex items-center space-x-1">
                            <button class="p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary edit-income-category" data-index="${index}">
                                <i class="ri-edit-line"></i>
                            </button>
                            <button class="p-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 delete-income-category" data-index="${index}">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-income-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        editCategory('income', index);
                    });
                });
                
                document.querySelectorAll('.delete-income-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        showDeleteConfirmation('income-category', index, 'kategori pemasukan');
                    });
                });
            }
            
            // Populate Expense Categories
            function populateExpenseCategories() {
                const container = document.getElementById('expense-category-list');
                if (!container) return;
                
                container.innerHTML = '';
                
                appData.categories.expense.forEach((category, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex items-center justify-between bg-gray-50 dark:bg-gray-800 p-2 rounded-lg';
                    item.innerHTML = `
                        <span class="text-gray-700 dark:text-gray-300">${category.charAt(0).toUpperCase() + category.slice(1).replace('-expense', '')}</span>
                        <div class="flex items-center space-x-1">
                            <button class="p-1 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary edit-expense-category" data-index="${index}">
                                <i class="ri-edit-line"></i>
                            </button>
                            <button class="p-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 delete-expense-category" data-index="${index}">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-expense-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        editCategory('expense', index);
                    });
                });
                
                document.querySelectorAll('.delete-expense-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        showDeleteConfirmation('expense-category', index, 'kategori pengeluaran');
                    });
                });
            }

            // Edit Category Function
            function editCategory(type, index) {
                const categoryName = appData.categories[type][index].replace('-income', '').replace('-expense', '');
                
                // Set values in the edit category form
                document.getElementById('edit-category-type').value = type;
                document.getElementById('edit-category-index').value = index;
                document.getElementById('edit-category-name').value = categoryName;
                
                // Show the edit category modal
                document.getElementById('edit-category-modal').classList.remove('hidden');
                document.getElementById('modal-backdrop').classList.remove('hidden');
            }

            // Delete Confirmation Function
            function showDeleteConfirmation(type, id, itemName) {
                // Set values for delete confirmation
                document.getElementById('delete-type').value = type;
                document.getElementById('delete-id').value = id;
                document.getElementById('delete-message').textContent = `Apakah Anda yakin ingin menghapus ${itemName} ini?`;
                
                // Show the confirmation modal
                document.getElementById('confirm-delete-modal').classList.remove('hidden');
                document.getElementById('modal-backdrop').classList.remove('hidden');
            }

            // Delete Item Function
            function deleteItem(type, id) {
                let success = false;
                
                if (type === 'transaction') {
                    // Delete transaction
                    const index = appData.transactions.findIndex(t => t.id === parseInt(id));
                    if (index !== -1) {
                        appData.transactions.splice(index, 1);
                        success = true;
                        
                        // Update UI
                        populateAllTransactions();
                        populateRecentTransactions();
                    }
                } else if (type === 'resident') {
                    // Delete resident
                    const index = appData.residents.findIndex(r => r.id === id);
                    if (index !== -1) {
                        appData.residents.splice(index, 1);
                        success = true;
                        
                        // Update UI
                        populateAllResidents();
                        populateResidentDues();
                        populateResidentCheckboxes();
                    }
                } else if (type === 'income-category') {
                    // Delete income category
                    const index = parseInt(id);
                    if (index >= 0 && index < appData.categories.income.length) {
                        // Check if category is used in any transaction
                        const categoryName = appData.categories.income[index];
                        const inUse = appData.transactions.some(t => t.category === categoryName);
                        
                        if (inUse) {
                            showToast('Peringatan', 'Kategori ini sedang digunakan dalam transaksi. Harap ubah transaksi terlebih dahulu.', 'warning');
                            return false;
                        }
                        
                        appData.categories.income.splice(index, 1);
                        success = true;
                        
                        // Update UI
                        populateIncomeCategories();
                        
                        // Update transaction category dropdown
                        updateCategoryDropdowns();
                    }
                } else if (type === 'expense-category') {
                    // Delete expense category
                    const index = parseInt(id);
                    if (index >= 0 && index < appData.categories.expense.length) {
                        // Check if category is used in any transaction
                        const categoryName = appData.categories.expense[index];
                        const inUse = appData.transactions.some(t => t.category === categoryName);
                        
                        if (inUse) {
                            showToast('Peringatan', 'Kategori ini sedang digunakan dalam transaksi. Harap ubah transaksi terlebih dahulu.', 'warning');
                            return false;
                        }
                        
                        appData.categories.expense.splice(index, 1);
                        success = true;
                        
                        // Update UI
                        populateExpenseCategories();
                        
                        // Update transaction category dropdown
                        updateCategoryDropdowns();
                    }
                }
                
                return success;
            }

            // Update Category Dropdowns
            function updateCategoryDropdowns() {
                const transactionCategory = document.getElementById('transaction-category');
                if (!transactionCategory) return;
                
                // Save current selection if any
                const currentSelection = transactionCategory.value;
                
                // Clear current options
                const incomeOptgroup = transactionCategory.querySelector('#income-categories');
                const expenseOptgroup = transactionCategory.querySelector('#expense-categories');
                
                if (incomeOptgroup) incomeOptgroup.innerHTML = '';
                if (expenseOptgroup) expenseOptgroup.innerHTML = '';
                
                // Add income categories
                if (incomeOptgroup) {
                    appData.categories.income.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category.charAt(0).toUpperCase() + category.slice(1).replace('-income', '');
                        incomeOptgroup.appendChild(option);
                    });
                }
                
                // Add expense categories
                if (expenseOptgroup) {
                    appData.categories.expense.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category.charAt(0).toUpperCase() + category.slice(1).replace('-expense', '');
                        expenseOptgroup.appendChild(option);
                    });
                }
                
                // Try to restore previous selection
                if (currentSelection && (appData.categories.income.includes(currentSelection) || appData.categories.expense.includes(currentSelection))) {
                    transactionCategory.value = currentSelection;
                } else {
                    // Default to first option of applicable type
                    const type = document.querySelector('input[name="transaction-type"]:checked').value;
                    if (type === 'income' && appData.categories.income.length > 0) {
                        transactionCategory.value = appData.categories.income[0];
                    } else if (type === 'expense' && appData.categories.expense.length > 0) {
                        transactionCategory.value = appData.categories.expense[0];
                    }
                }
            }

            // Populate Report Transactions
            function populateReportTransactions() {
                const reportTransactionsContainer = document.getElementById('report-transactions');
                if (!reportTransactionsContainer) return;
                
                reportTransactionsContainer.innerHTML = '';

                // Get July transactions for the sample report
                const reportTransactions = appData.transactions.filter(t => t.date.startsWith('2023-07'));

                reportTransactions.forEach(transaction => {
                    const tr = document.createElement('tr');
                    
                    const tdDate = document.createElement('td');
                    tdDate.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300';
                    tdDate.textContent = formatDate(transaction.date);
                    
                    const tdCategory = document.createElement('td');
                    tdCategory.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
                    const categoryName = transaction.category.charAt(0).toUpperCase() + transaction.category.slice(1);
                    tdCategory.innerHTML = `
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            transaction.type === 'income' 
                                ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' 
                                : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                        }">
                            ${categoryName}
                        </span>
                    `;
                    
                    const tdDesc = document.createElement('td');
                    tdDesc.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
                    tdDesc.textContent = transaction.description;
                    
                    const tdAmount = document.createElement('td');
                    tdAmount.className = 'px-4 py-3 whitespace-nowrap text-sm text-right font-medium ' + 
                        (transaction.type === 'income' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400');
                    tdAmount.textContent = (transaction.type === 'income' ? '+ ' : '- ') + formatCurrency(transaction.amount);
                    
                    tr.appendChild(tdDate);
                    tr.appendChild(tdCategory);
                    tr.appendChild(tdDesc);
                    tr.appendChild(tdAmount);
                    
                    reportTransactionsContainer.appendChild(tr);
                });
            }

            // Show Toast Notification
            function showToast(title, message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastTitle = document.getElementById('toast-title');
                const toastMessage = document.getElementById('toast-message');
                const toastIcon = document.getElementById('toast-icon');
                const toastIconSymbol = document.getElementById('toast-icon-symbol');
                
                // Set toast content
                toastTitle.textContent = title;
                toastMessage.textContent = message;
                
                // Set toast style based on type
                switch (type) {
                    case 'success':
                        toastIcon.className = 'flex-shrink-0 w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center mr-3';
                        toastIconSymbol.className = 'ri-check-line text-green-500 dark:text-green-400';
                        break;
                    case 'error':
                        toastIcon.className = 'flex-shrink-0 w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center mr-3';
                        toastIconSymbol.className = 'ri-error-warning-line text-red-500 dark:text-red-400';
                        break;
                    case 'warning':
                        toastIcon.className = 'flex-shrink-0 w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/20 flex items-center justify-center mr-3';
                        toastIconSymbol.className = 'ri-alert-line text-yellow-500 dark:text-yellow-400';
                        break;
                    case 'info':
                        toastIcon.className = 'flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center mr-3';
                        toastIconSymbol.className = 'ri-information-line text-blue-500 dark:text-blue-400';
                        break;
                }
                
                // Show toast
                toast.classList.remove('hidden', 'translate-y-10', 'opacity-0');
                
                // Hide toast after 3 seconds
                setTimeout(() => {
                    toast.classList.add('translate-y-10', 'opacity-0');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 300);
                }, 3000);
            }

            // Event listeners for tab navigation
            function setupTabNavigation() {
                // Desktop tab navigation
                elements.tabLinks.forEach(tabLink => {
                    tabLink.addEventListener('click', function() {
                        // Skip if trying to click on a hidden admin-only tab while in resident mode
                        if (appState.currentRole === 'resident' && this.classList.contains('admin-only')) {
                            return;
                        }
                        
                        const tabId = this.dataset.tab;
                        
                        // Update tab links
                        elements.tabLinks.forEach(link => {
                            link.classList.remove('active', 'border-primary', 'text-primary');
                            link.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                        });
                        this.classList.add('active', 'border-primary', 'text-primary');
                        this.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                        
                        // Update mobile tab links
                        elements.mobileTabLinks.forEach(link => {
                            if (link.dataset.tab === tabId) {
                                link.classList.add('active', 'text-primary');
                                link.classList.remove('text-gray-500', 'dark:text-gray-400');
                            } else {
                                link.classList.remove('active', 'text-primary');
                                link.classList.add('text-gray-500', 'dark:text-gray-400');
                            }
                        });
                        
                        // Show selected tab content
                        elements.tabContents.forEach(content => {
                            if (content.id === tabId) {
                                content.classList.add('active');
                                // Initialize charts when the tab is shown
                                if (tabId === 'laporan') {
                                    setTimeout(() => {
                                        initReportCharts();
                                    }, 100);
                                } else if (tabId === 'pengaturan') {
                                    populateIncomeCategories();
                                    populateExpenseCategories();
                                }
                            } else {
                                content.classList.remove('active');
                            }
                        });
                    });
                });

                // Mobile tab navigation
                elements.mobileTabLinks.forEach(tabLink => {
                    tabLink.addEventListener('click', function() {
                        // Skip if trying to click on a hidden admin-only tab while in resident mode
                        if (appState.currentRole === 'resident' && this.classList.contains('admin-only')) {
                            return;
                        }
                        
                        const tabId = this.dataset.tab;
                        
                        // Update mobile tab links
                        elements.mobileTabLinks.forEach(link => {
                            link.classList.remove('active', 'text-primary');
                            link.classList.add('text-gray-500', 'dark:text-gray-400');
                        });
                        this.classList.add('active', 'text-primary');
                        this.classList.remove('text-gray-500', 'dark:text-gray-400');
                        
                        // Update desktop tab links
                        elements.tabLinks.forEach(link => {
                            if (link.dataset.tab === tabId) {
                                link.classList.add('active', 'border-primary', 'text-primary');
                                link.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                            } else {
                                link.classList.remove('active', 'border-primary', 'text-primary');
                                link.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                            }
                        });
                        
                        // Show selected tab content
                        elements.tabContents.forEach(content => {
                            if (content.id === tabId) {
                                content.classList.add('active');
                                // Initialize charts when the tab is shown
                                if (tabId === 'laporan') {
                                    setTimeout(() => {
                                        initReportCharts();
                                    }, 100);
                                } else if (tabId === 'pengaturan') {
                                    populateIncomeCategories();
                                    populateExpenseCategories();
                                }
                            } else {
                                content.classList.remove('active');
                            }
                        });
                    });
                });

                // "View All Transactions" button
                elements.viewAllTransactions.addEventListener('click', function() {
                    document.querySelector('.tab-link[data-tab="transaksi"]').click();
                });

                // "View All Residents" button
                if (elements.viewAllResidents) {
                    elements.viewAllResidents.addEventListener('click', function() {
                        document.querySelector('.tab-link[data-tab="penghuni"]').click();
                    });
                }
            }

            // Event listeners for theme toggle
            function setupThemeToggle() {
                elements.themeToggle.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark');
                    elements.themePreference.checked = document.documentElement.classList.contains('dark');
                });

                elements.themePreference.addEventListener('change', function() {
                    if (this.checked) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });

                // Update theme toggle appearance
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            this.nextElementSibling.nextElementSibling.classList.add('left-7');
                            this.nextElementSibling.nextElementSibling.classList.remove('left-1');
                            this.nextElementSibling.classList.add('bg-primary');
                        } else {
                            this.nextElementSibling.nextElementSibling.classList.add('left-1');
                            this.nextElementSibling.nextElementSibling.classList.remove('left-7');
                            this.nextElementSibling.classList.remove('bg-primary');
                        }
                    });
                });
            }

            // Event listeners for user menu
            function setupUserMenu() {
                elements.userMenuButton.addEventListener('click', function() {
                    elements.userDropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    if (!elements.userMenuButton.contains(event.target) && !elements.userDropdown.contains(event.target)) {
                        elements.userDropdown.classList.add('hidden');
                    }
                });

                // Edit Profile button
                elements.editProfile.addEventListener('click', function() {
                    elements.userDropdown.classList.add('hidden');
                    elements.modalBackdrop.classList.remove('hidden');
                    elements.userProfileModal.classList.remove('hidden');
                });

                // Change User button
                elements.changeUser.addEventListener('click', function() {
                    elements.userDropdown.classList.add('hidden');
                    elements.modalBackdrop.classList.remove('hidden');
                    elements.changeUserModal.classList.remove('hidden');
                });
                
                // Admin view button
                if (elements.adminView) {
                    elements.adminView.addEventListener('click', function() {
                        switchRole('admin');
                    });
                }
                
                // Resident view button
                if (elements.residentView) {
                    elements.residentView.addEventListener('click', function() {
                        switchRole('resident');
                    });
                }
                
                // Mobile admin view button
                if (elements.mobileAdminView) {
                    elements.mobileAdminView.addEventListener('click', function() {
                        switchRole('admin');
                    });
                }
                
                // Mobile resident view button
                if (elements.mobileResidentView) {
                    elements.mobileResidentView.addEventListener('click', function() {
                        switchRole('resident');
                    });
                }
                
                // Switch role button in banner
                if (elements.switchRoleBtn) {
                    elements.switchRoleBtn.addEventListener('click', function() {
                        switchRole(appState.currentRole === 'admin' ? 'resident' : 'admin');
                    });
                }
                
                // Set up user selection in change user modal
                document.querySelectorAll('.user-item').forEach(userItem => {
                    userItem.addEventListener('click', function() {
                        const userId = this.dataset.userId;
                        const userRole = this.dataset.userRole;
                        const userName = this.querySelector('p.font-medium').textContent;
                        
                        // Update current user
                        appState.currentUser = {
                            id: userId,
                            name: userName,
                            role: userRole
                        };
                        
                        // Update UI
                        document.getElementById('user-name').textContent = userName;
                        document.getElementById('user-initial').textContent = userName.charAt(0);
                        document.getElementById('user-email').textContent = userId + '@kasmess.com';
                        
                        // If role is different, switch to that role
                        if (userRole !== appState.currentRole) {
                            switchRole(userRole);
                        }
                        
                        // Close modal
                        closeAllModals();
                        
                        // Show toast
                        showToast('Pengguna Berubah', `Selamat datang, ${userName}!`, 'success');
                    });
                });
            }

            // Event listeners for modals
            function setupModals() {
                // Close modals when clicking the backdrop
                elements.modalBackdrop.addEventListener('click', function() {
                    closeAllModals();
                });

                // Close buttons in modals
                elements.closeModalButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        closeAllModals();
                    });
                });

                // Add Reminder button
                if (elements.addReminderBtn) {
                    elements.addReminderBtn.addEventListener('click', function() {
                        elements.modalBackdrop.classList.remove('hidden');
                        elements.reminderModal.classList.remove('hidden');
                    });
                }

                // Close toast
                elements.closeToast.addEventListener('click', function() {
                    elements.toast.classList.add('translate-y-10', 'opacity-0');
                    setTimeout(() => {
                        elements.toast.classList.add('hidden');
                    }, 300);
                });
                
                // Confirm delete button
                elements.confirmDeleteBtn.addEventListener('click', function() {
                    const type = document.getElementById('delete-type').value;
                    const id = document.getElementById('delete-id').value;
                    
                    const success = deleteItem(type, id);
                    
                    if (success) {
                        // Show success toast
                        showToast('Sukses', 'Item berhasil dihapus', 'success');
                        
                        // Close modal
                        closeAllModals();
                    }
                });
                
                // Edit category form submission
                document.getElementById('edit-category-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const type = document.getElementById('edit-category-type').value;
                    const index = parseInt(document.getElementById('edit-category-index').value);
                    const newName = document.getElementById('edit-category-name').value;
                    
                    if (newName.trim() === '') {
                        showToast('Error', 'Nama kategori tidak boleh kosong', 'error');
                        return;
                    }
                    
                    // Check if this name already exists in the categories
                    let suffix = type === 'income' ? '-income' : '-expense';
                    let newCategoryName = newName.toLowerCase() + suffix;
                    
                    const nameExists = appData.categories[type].some((cat, idx) => idx !== index && cat === newCategoryName);
                    if (nameExists) {
                        showToast('Error', 'Nama kategori sudah ada', 'error');
                        return;
                    }
                    
                    // Get the old category name before updating
                    const oldCategoryName = appData.categories[type][index];
                    
                    // Update the category name
                    appData.categories[type][index] = newCategoryName;
                    
                    // Update any transactions using this category
                    appData.transactions.forEach(transaction => {
                        if (transaction.category === oldCategoryName) {
                            transaction.category = newCategoryName;
                        }
                    });
                    
                    // Update UI
                    if (type === 'income') {
                        populateIncomeCategories();
                    } else {
                        populateExpenseCategories();
                    }
                    
                    // Update transaction category dropdown
                    updateCategoryDropdowns();
                    
                    // Close modal
                    closeAllModals();
                    
                    // Show success toast
                    showToast('Sukses', 'Kategori berhasil diperbarui', 'success');
                });
            }

            function closeAllModals() {
                elements.modalBackdrop.classList.add('hidden');
                elements.userProfileModal.classList.add('hidden');
                elements.changeUserModal.classList.add('hidden');
                elements.reminderModal.classList.add('hidden');
                elements.editCategoryModal.classList.add('hidden');
                elements.confirmDeleteModal.classList.add('hidden');
            }

            // Event listeners for forms
            function setupForms() {
                // Transaction form type selection
                elements.transactionTypeRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        document.querySelectorAll('label input[name="transaction-type"] + div').forEach(div => {
                            div.classList.add('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                            div.classList.remove('border-green-500', 'border-red-500', 'bg-green-50', 'bg-red-50', 'dark:bg-green-900/20', 'dark:bg-red-900/20', 'text-green-700', 'text-red-700', 'dark:text-green-300', 'dark:text-red-300');
                        });

                        if (this.value === 'income') {
                            this.nextElementSibling.classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20', 'text-green-700', 'dark:text-green-300');
                            this.nextElementSibling.classList.remove('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                            
                            const selectElement = document.getElementById('transaction-category');
                            if (selectElement) {
                                const incomeCategories = selectElement.querySelector('#income-categories');
                                const expenseCategories = selectElement.querySelector('#expense-categories');
                                if (incomeCategories && expenseCategories) {
                                    incomeCategories.disabled = false;
                                    expenseCategories.disabled = true;
                                    // Select the first income category
                                    if (incomeCategories.children.length > 0) {
                                        selectElement.value = incomeCategories.children[0].value;
                                    }
                                }
                            }
                        } else {
                            this.nextElementSibling.classList.add('border-red-500', 'bg-red-50', 'dark:bg-red-900/20', 'text-red-700', 'dark:text-red-300');
                            this.nextElementSibling.classList.remove('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                            
                            const selectElement = document.getElementById('transaction-category');
                            if (selectElement) {
                                const incomeCategories = selectElement.querySelector('#income-categories');
                                const expenseCategories = selectElement.querySelector('#expense-categories');
                                if (incomeCategories && expenseCategories) {
                                    incomeCategories.disabled = true;
                                    expenseCategories.disabled = false;
                                    // Select the first expense category
                                    if (expenseCategories.children.length > 0) {
                                        selectElement.value = expenseCategories.children[0].value;
                                    }
                                }
                            }
                        }
                    });
                });

                // Set initial selected categories based on radio selection
                const selectedRadio = document.querySelector('input[name="transaction-type"]:checked');
                if (selectedRadio) {
                    const selectElement = document.getElementById('transaction-category');
                    if (selectElement) {
                        const incomeCategories = selectElement.querySelector('#income-categories');
                        const expenseCategories = selectElement.querySelector('#expense-categories');
                        if (incomeCategories && expenseCategories) {
                            if (selectedRadio.value === 'income') {
                                incomeCategories.disabled = false;
                                expenseCategories.disabled = true;
                                if (incomeCategories.children.length > 0) {
                                    selectElement.value = incomeCategories.children[0].value;
                                }
                            } else {
                                incomeCategories.disabled = true;
                                expenseCategories.disabled = false;
                                if (expenseCategories.children.length > 0) {
                                    selectElement.value = expenseCategories.children[0].value;
                                }
                            }
                        }
                    }
                }

                // Transaction split type change
                if (elements.transactionSplitType) {
                    elements.transactionSplitType.addEventListener('change', function() {
                        const customSplitContainer = document.getElementById('custom-split-container');
                        
                        if (this.value === 'equal') {
                            customSplitContainer.classList.add('hidden');
                        } else {
                            customSplitContainer.classList.remove('hidden');
                            customSplitContainer.innerHTML = '';
                            
                            // Get selected residents
                            const selectedResidents = Array.from(document.querySelectorAll('input[name="resident-checkbox"]:checked')).map(cb => {
                                const residentId = cb.value;
                                const resident = appData.residents.find(r => r.id === residentId);
                                return resident;
                            });
                            
                            if (selectedResidents.length === 0) {
                                customSplitContainer.innerHTML = '<p class="text-sm text-gray-500 dark:text-gray-400">Pilih penghuni terlebih dahulu.</p>';
                                return;
                            }
                            
                            // Create inputs for custom split
                            selectedResidents.forEach(resident => {
                                const div = document.createElement('div');
                                div.className = 'flex items-center space-x-2 mb-2';
                                
                                div.innerHTML = `
                                    <span class="text-sm text-gray-700 dark:text-gray-300 w-24">${resident.name}:</span>
                                    <input type="${this.value === 'percentage' ? 'number' : 'text'}" 
                                           class="flex-1 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary text-base"
                                           data-resident-id="${resident.id}"
                                           ${this.value === 'percentage' ? 'min="0" max="100"' : ''}
                                           placeholder="${this.value === 'percentage' ? '0%' : 'Rp 0'}">
                                `;
                                
                                customSplitContainer.appendChild(div);
                            });
                            
                            // Add helper text
                            const helperText = document.createElement('p');
                            helperText.className = 'text-xs text-gray-500 dark:text-gray-400 mt-1';
                            helperText.textContent = this.value === 'percentage' 
                                ? 'Total persentase harus 100%.' 
                                : 'Total jumlah harus sama dengan jumlah transaksi.';
                            customSplitContainer.appendChild(helperText);
                        }
                    });
                }

                // Reset transaction form
                if (elements.resetTransaction) {
                    elements.resetTransaction.addEventListener('click', function() {
                        elements.transactionForm.reset();
                        document.querySelector('input[name="transaction-type"][value="income"]').checked = true;
                        document.querySelector('input[name="transaction-type"][value="income"] + div').classList.add('border-green-500', 'bg-green-50', 'dark:bg-green-900/20', 'text-green-700', 'dark:text-green-300');
                        document.querySelector('input[name="transaction-type"][value="income"] + div').classList.remove('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                        document.querySelector('input[name="transaction-type"][value="expense"] + div').classList.add('border-transparent', 'bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                        document.querySelector('input[name="transaction-type"][value="expense"] + div').classList.remove('border-red-500', 'bg-red-50', 'dark:bg-red-900/20', 'text-red-700', 'dark:text-red-300');
                        
                        // Reset checkboxes
                        document.querySelectorAll('input[name="resident-checkbox"]').forEach(cb => cb.checked = false);
                        
                        // Hide custom split container
                        elements.customSplitContainer.classList.add('hidden');
                        
                        // Set default category
                        const selectElement = document.getElementById('transaction-category');
                        if (selectElement) {
                            const incomeCategories = selectElement.querySelector('#income-categories');
                            const expenseCategories = selectElement.querySelector('#expense-categories');
                            if (incomeCategories && expenseCategories) {
                                incomeCategories.disabled = false;
                                expenseCategories.disabled = true;
                                if (incomeCategories.children.length > 0) {
                                    selectElement.value = incomeCategories.children[0].value;
                                }
                            }
                        }
                        
                        // Reset transaction ID and edit mode
                        document.getElementById('transaction-id').value = '';
                        appState.editMode.transaction = false;
                        document.getElementById('transaction-submit-text').textContent = 'Tambah Transaksi';
                        
                        // Set current date
                        setCurrentDate();
                    });
                }

                // Reset resident form
                if (elements.resetResident) {
                    elements.resetResident.addEventListener('click', function() {
                        elements.residentForm.reset();
                        document.getElementById('resident-id').value = '';
                        document.getElementById('resident-form-title').textContent = 'Tambah Penghuni';
                        document.getElementById('resident-submit-text').textContent = 'Tambah Penghuni';
                        
                        // Reset edit mode
                        appState.editMode.resident = false;
                        
                        // Set current date
                        setCurrentDate();
                    });
                }

                // Transaction form submission
                if (elements.transactionForm) {
                    elements.transactionForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const id = document.getElementById('transaction-id').value ? parseInt(document.getElementById('transaction-id').value) : null;
                        const type = document.querySelector('input[name="transaction-type"]:checked').value;
                        const date = document.getElementById('transaction-date').value;
                        const amount = document.getElementById('transaction-amount').value;
                        const category = document.getElementById('transaction-category').value;
                        const description = document.getElementById('transaction-description').value;
                        
                        const relatedResidents = Array.from(document.querySelectorAll('input[name="resident-checkbox"]:checked')).map(cb => cb.value);
                        
                        if (appState.editMode.transaction && id) {
                            // Update existing transaction
                            const index = appData.transactions.findIndex(t => t.id === id);
                            if (index !== -1) {
                                appData.transactions[index] = {
                                    id,
                                    date,
                                    type,
                                    category,
                                    amount: parseFloat(amount),
                                    description,
                                    relatedResidents
                                };
                                
                                // Show success toast
                                showToast('Sukses', 'Transaksi berhasil diperbarui', 'success');
                            }
                        } else {
                            // Add new transaction
                            const newTransaction = {
                                id: appData.transactions.length + 1,
                                date,
                                type,
                                category,
                                amount: parseFloat(amount),
                                description,
                                relatedResidents
                            };
                            
                            appData.transactions.push(newTransaction);
                            
                            // Show success toast
                            showToast('Sukses', 'Transaksi berhasil ditambahkan', 'success');
                        }
                        
                        // Update UI
                        populateAllTransactions();
                        populateRecentTransactions();
                        
                        // Reset form
                        elements.resetTransaction.click();
                    });
                }

                // Resident form submission
                if (elements.residentForm) {
                    elements.residentForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const id = document.getElementById('resident-id').value || String(appData.residents.length + 1);
                        const name = document.getElementById('resident-name').value;
                        const email = document.getElementById('resident-email').value;
                        const phone = document.getElementById('resident-phone').value;
                        const room = document.getElementById('resident-room').value;
                        const joinDate = document.getElementById('resident-join-date').value;
                        const dues = document.getElementById('resident-dues').value;
                        const notes = document.getElementById('resident-notes').value;
                        
                        if (appState.editMode.resident) {
                            // Update existing resident
                            const index = appData.residents.findIndex(r => r.id === id);
                            if (index !== -1) {
                                appData.residents[index] = {
                                    id,
                                    name,
                                    email,
                                    phone,
                                    room,
                                    joinDate,
                                    dues: parseFloat(dues),
                                    duesPaid: appData.residents[index].duesPaid,
                                    notes
                                };
                                
                                // Show success toast
                                showToast('Sukses', 'Data penghuni berhasil diperbarui', 'success');
                            }
                        } else {
                            // Add new resident
                            const newResident = {
                                id,
                                name,
                                email,
                                phone,
                                room,
                                joinDate,
                                dues: parseFloat(dues),
                                duesPaid: false,
                                notes
                            };
                            
                            appData.residents.push(newResident);
                            
                            // Show success toast
                            showToast('Sukses', 'Penghuni baru berhasil ditambahkan', 'success');
                        }
                        
                        // Update UI
                        populateAllResidents();
                        populateResidentDues();
                        populateResidentCheckboxes();
                        
                        // Reset form
                        elements.resetResident.click();
                        
                        // Reset edit mode
                        appState.editMode.resident = false;
                    });
                }

                // User profile form submission
                if (elements.userProfileForm) {
                    elements.userProfileForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const name = document.getElementById('profile-name').value;
                        const email = document.getElementById('profile-email').value;
                        const role = document.getElementById('profile-role').value;
                        
                        // Update user info in UI
                        document.getElementById('user-name').textContent = name;
                        document.getElementById('user-initial').textContent = name.charAt(0);
                        document.getElementById('user-email').textContent = email;
                        
                        // Update app state
                        appState.currentUser.name = name;
                        
                        // If role changed, update that too
                        if (role !== appState.currentRole) {
                            switchRole(role);
                        }
                        
                        // Close modal
                        closeAllModals();
                        
                        // Show success toast
                        showToast('Sukses', 'Profil berhasil diperbarui', 'success');
                    });
                }

                // Reminder form submission
                if (elements.reminderForm) {
                    elements.reminderForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const title = document.getElementById('reminder-title').value;
                        const date = document.getElementById('reminder-date').value;
                        const priority = document.getElementById('reminder-priority').value;
                        const notes = document.getElementById('reminder-notes').value;
                        const notifyToElement = document.getElementById('reminder-notify');
                        const notifyTo = notifyToElement ? 
                            Array.from(notifyToElement.selectedOptions).map(opt => opt.value) : ['all'];
                        
                        const newReminder = {
                            id: appData.reminders.length + 1,
                            title,
                            date,
                            priority,
                            notes,
                            notifyTo: notifyTo[0] // Simplify for demo
                        };
                        
                        appData.reminders.push(newReminder);
                        
                        // Update UI
                        populateReminders();
                        
                        // Close modal
                        closeAllModals();
                        
                        // Reset form
                        elements.reminderForm.reset();
                        
                        // Show success toast
                        showToast('Sukses', 'Pengingat berhasil ditambahkan', 'success');
                    });
                }

                // Mess info form submission
                if (elements.messInfoForm) {
                    elements.messInfoForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        // In a real app, this would be sent to a server
                        
                        // Show success toast
                        showToast('Sukses', 'Informasi mess berhasil diperbarui', 'success');
                    });
                }

                // Report type change
                if (elements.reportType) {
                    elements.reportType.addEventListener('change', function() {
                        if (this.value === 'custom') {
                            elements.customDateRange.classList.remove('hidden');
                            elements.reportMonth.classList.add('hidden');
                            elements.reportYear.classList.add('hidden');
                        } else {
                            elements.customDateRange.classList.add('hidden');
                            elements.reportMonth.classList.remove('hidden');
                            elements.reportYear.classList.remove('hidden');
                        }
                    });
                }

                // Generate report
                if (elements.generateReport) {
                    elements.generateReport.addEventListener('click', function() {
                        elements.reportResult.classList.remove('hidden');
                        
                        // In a real app, this would fetch data based on the selected period
                        
                        // For the demo, we'll just show the sample data
                        populateReportTransactions();
                        
                        // Initialize chart when report is generated
                        setTimeout(() => {
                            initReportCharts();
                        }, 100);
                        
                        // Show success toast
                        showToast('Sukses', 'Laporan berhasil dibuat', 'success');
                    });
                }
                
                // Search transaction listener
                if (elements.searchTransaction) {
                    elements.searchTransaction.addEventListener('input', function() {
                        appState.transactionFilter.searchTerm = this.value;
                        populateAllTransactions();
                    });
                }
                
                // Filter transaction type listener
                if (elements.filterTransaction) {
                    elements.filterTransaction.addEventListener('change', function() {
                        appState.transactionFilter.type = this.value;
                        populateAllTransactions();
                    });
                }
                
                // Search resident listener
                if (elements.searchResident) {
                    elements.searchResident.addEventListener('input', function() {
                        populateAllResidents();
                    });
                }
                
                // Filter tabs for recent transactions
                elements.filterTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Update active state of tabs
                        elements.filterTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update filter
                        appState.transactionFilter.timeframe = this.dataset.filter;
                        
                        // Update transactions
                        populateRecentTransactions();
                    });
                });
                
                // Add Income Category
                if (elements.addIncomeCategory) {
                    elements.addIncomeCategory.addEventListener('click', function() {
                        const newCategoryInput = document.getElementById('new-income-category');
                        const newCategory = newCategoryInput.value.trim();
                        
                        if (newCategory === '') {
                            showToast('Error', 'Nama kategori tidak boleh kosong', 'error');
                            return;
                        }
                        
                        // Check if this name already exists in the categories
                        const newCategoryName = newCategory.toLowerCase() + '-income';
                        const nameExists = appData.categories.income.includes(newCategoryName);
                        if (nameExists) {
                            showToast('Error', 'Nama kategori sudah ada', 'error');
                            return;
                        }
                        
                        // Add the new category
                        appData.categories.income.push(newCategoryName);
                        
                        // Update UI
                        populateIncomeCategories();
                        
                        // Update transaction category dropdown
                        updateCategoryDropdowns();
                        
                        // Clear input
                        newCategoryInput.value = '';
                        
                        // Show success toast
                        showToast('Sukses', 'Kategori pemasukan berhasil ditambahkan', 'success');
                    });
                }
                
                // Add Expense Category
                if (elements.addExpenseCategory) {
                    elements.addExpenseCategory.addEventListener('click', function() {
                        const newCategoryInput = document.getElementById('new-expense-category');
                        const newCategory = newCategoryInput.value.trim();
                        
                        if (newCategory === '') {
                            showToast('Error', 'Nama kategori tidak boleh kosong', 'error');
                            return;
                        }
                        
                        // Check if this name already exists in the categories
                        const newCategoryName = newCategory.toLowerCase() + '-expense';
                        const nameExists = appData.categories.expense.includes(newCategoryName);
                        if (nameExists) {
                            showToast('Error', 'Nama kategori sudah ada', 'error');
                            return;
                        }
                        
                        // Add the new category
                        appData.categories.expense.push(newCategoryName);
                        
                        // Update UI
                        populateExpenseCategories();
                        
                        // Update transaction category dropdown
                        updateCategoryDropdowns();
                        
                        // Clear input
                        newCategoryInput.value = '';
                        
                        // Show success toast
                        showToast('Sukses', 'Kategori pengeluaran berhasil ditambahkan', 'success');
                    });
                }
            }

            // Set current date in forms
            function setCurrentDate() {
                const today = new Date().toISOString().split('T')[0];
                
                if (document.getElementById('transaction-date')) {
                    document.getElementById('transaction-date').value = today;
                }
                
                if (document.getElementById('resident-join-date')) {
                    document.getElementById('resident-join-date').value = today;
                }
                
                if (document.getElementById('reminder-date')) {
                    document.getElementById('reminder-date').value = today;
                }
                
                if (document.getElementById('report-start-date')) {
                    document.getElementById('report-start-date').value = today;
                }
                
                if (document.getElementById('report-end-date')) {
                    document.getElementById('report-end-date').value = today;
                }
            }

            // Initialize the application
            function init() {
                setupTabNavigation();
                setupThemeToggle();
                setupUserMenu();
                setupModals();
                setupForms();
                
                initDashboardCharts();
                populateRecentTransactions();
                populateResidentDues();
                populateReminders();
                populateAllTransactions();
                populateAllResidents();
                populateResidentCheckboxes();
                populateReportTransactions();
                populateIncomeCategories();
                populateExpenseCategories();
                
                setCurrentDate();

                // Add event listener for tab changes to reinitialize charts
                document.querySelectorAll('.tab-link').forEach(tab => {
                    tab.addEventListener('click', function() {
                        if (this.dataset.tab === 'laporan') {
                            setTimeout(() => {
                                initReportCharts();
                            }, 100);
                        }
                    });
                });

                // Make sure toggle switches look correct on load
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    if (checkbox.checked) {
                        if (checkbox.nextElementSibling && checkbox.nextElementSibling.nextElementSibling) {
                            checkbox.nextElementSibling.classList.add('bg-primary');
                            checkbox.nextElementSibling.nextElementSibling.classList.add('left-7');
                            checkbox.nextElementSibling.nextElementSibling.classList.remove('left-1');
                        }
                    }
                });
                
                // Set initial role
                switchRole('admin');
            }
            
            // Run initialization when DOM is fully loaded
            init();
        })();
    </script>
</body>
</html>
